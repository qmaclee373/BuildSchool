if (self.CavalryLogger) { CavalryLogger.start_js(["qLnzXGt"]); }

__d("PagesManagerInboxTypedLogger",["Banzai","GeneratedLoggerUtils"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var c=a.prototype;c.log=function(a){b("GeneratedLoggerUtils").log("logger:PagesManagerInboxLoggerConfig",this.$1,b("Banzai").BASIC,a)};c.logVital=function(a){b("GeneratedLoggerUtils").log("logger:PagesManagerInboxLoggerConfig",this.$1,b("Banzai").VITAL,a)};c.logImmediately=function(a){b("GeneratedLoggerUtils").log("logger:PagesManagerInboxLoggerConfig",this.$1,{signal:!0},a)};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setAutomatedResponseTriggerType=function(a){this.$1.automated_response_trigger_type=a;return this};c.setBroadcastAudience=function(a){this.$1.broadcast_audience=a;return this};c.setBroadcastMessageFormat=function(a){this.$1.broadcast_message_format=a;return this};c.setEventName=function(a){this.$1.event_name=a;return this};c.setFirstPayloadTime=function(a){this.$1.first_payload_time=a;return this};c.setFolder=function(a){this.$1.folder=a;return this};c.setHadError=function(a){this.$1.had_error=a;return this};c.setHref=function(a){this.$1.href=a;return this};c.setIsCached=function(a){this.$1.is_cached=a;return this};c.setIsInboxRedesignWithSideNav=function(a){this.$1.is_inbox_redesign_with_side_nav=a;return this};c.setItemsCount=function(a){this.$1.items_count=a;return this};c.setLoadTime=function(a){this.$1.load_time=a;return this};c.setMessage=function(a){this.$1.message=a;return this};c.setModuleName=function(a){this.$1.module_name=a;return this};c.setNuxID=function(a){this.$1.nux_id=a;return this};c.setPageCommItemID=function(a){this.$1.page_comm_item_id=a;return this};c.setPageCommItemStatus=function(a){this.$1.page_comm_item_status=a;return this};c.setPageCommSearch=function(a){this.$1.page_comm_search=a;return this};c.setPageCommSearchType=function(a){this.$1.page_comm_search_type=a;return this};c.setPageID=function(a){this.$1.page_id=a;return this};c.setPlatform=function(a){this.$1.platform=a;return this};c.setScreenHeight=function(a){this.$1.screen_height=a;return this};c.setScreenWidth=function(a){this.$1.screen_width=a;return this};c.setStackTrace=function(a){this.$1.stack_trace=a;return this};c.setThreadToken=function(a){this.$1.thread_token=a;return this};c.setTimeSinceLoad=function(a){this.$1.time_since_load=a;return this};c.setTraceID=function(a){this.$1.trace_id=a;return this};c.setUsesStreamingPagination=function(a){this.$1.uses_streaming_pagination=a;return this};c.setViewMode=function(a){this.$1.view_mode=a;return this};return a}();c={automated_response_trigger_type:!0,broadcast_audience:!0,broadcast_message_format:!0,event_name:!0,first_payload_time:!0,folder:!0,had_error:!0,href:!0,is_cached:!0,is_inbox_redesign_with_side_nav:!0,items_count:!0,load_time:!0,message:!0,module_name:!0,nux_id:!0,page_comm_item_id:!0,page_comm_item_status:!0,page_comm_search:!0,page_comm_search_type:!0,page_id:!0,platform:!0,screen_height:!0,screen_width:!0,stack_trace:!0,thread_token:!0,time_since_load:!0,trace_id:!0,uses_streaming_pagination:!0,view_mode:!0};e.exports=a}),null);
__d("PagesMessagingInboxActionsTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var c=a.prototype;c.log=function(a){b("GeneratedLoggerUtils").log("logger:PagesMessagingInboxActionsLoggerConfig",this.$1,b("Banzai").BASIC,a)};c.logVital=function(a){b("GeneratedLoggerUtils").log("logger:PagesMessagingInboxActionsLoggerConfig",this.$1,b("Banzai").VITAL,a)};c.logImmediately=function(a){b("GeneratedLoggerUtils").log("logger:PagesMessagingInboxActionsLoggerConfig",this.$1,{signal:!0},a)};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setInboxAction=function(a){this.$1.inbox_action=a;return this};c.setPageCommSearchType=function(a){this.$1.page_comm_search_type=a;return this};c.setPlatform=function(a){this.$1.platform=a;return this};c.updateExtraData=function(a){a=b("nullthrows")(b("GeneratedLoggerUtils").serializeMap(a));b("GeneratedLoggerUtils").checkExtraDataFieldNames(a,g);this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.addToExtraData=function(a,b){var c={};c[a]=b;return this.updateExtraData(c)};return a}();var g={inbox_action:!0,page_comm_search_type:!0,platform:!0};e.exports=a}),null);
__d("MessengerUserProfileLocationUtilsQuery.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,concreteType:"StreetAddress",kind:"LinkedField",name:"address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MessengerUserProfileLocationUtilsQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:"user",args:null,concreteType:"User",kind:"LinkedField",name:"account_user",plural:!1,selections:[a],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"MessengerUserProfileLocationUtilsQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:"user",args:null,concreteType:"User",kind:"LinkedField",name:"account_user",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:"2746984198655487",metadata:{},name:"MessengerUserProfileLocationUtilsQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("LivechatPluginGuestMessageThreadQueryContainerQuery.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"data"}],b=[{kind:"Variable",name:"data",variableName:"data"}],c={alias:null,args:null,kind:"ScalarField",name:"folder",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"unread_count",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"messages_count",storageKey:null},f={alias:"last_read_receipt",args:[{kind:"Literal",name:"last",value:1}],concreteType:"MessagingReadReceiptsOfThreadConnection",kind:"LinkedField",name:"read_receipts",plural:!1,selections:[{alias:null,args:null,concreteType:"MessagingReadReceipt",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:"action",args:null,kind:"ScalarField",name:"timestamp_precise",storageKey:null},{alias:"watermark",args:null,kind:"ScalarField",name:"timestamp_precise",storageKey:null}],storageKey:null}],storageKey:"read_receipts(last:1)"},g={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},h={alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"message_sender",plural:!1,selections:[g,{alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null}],storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"message_id",storageKey:null},j={alias:null,args:null,concreteType:"MessageSourceData",kind:"LinkedField",name:"message_source_data",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_source",storageKey:null}],storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"tags_list",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"offline_threading_id",storageKey:null},m={alias:null,args:null,concreteType:"MessageThreadKey",kind:"LinkedField",name:"message_thread_key",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"thread_fbid",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"other_user_id",storageKey:null}],storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"timestamp_precise",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"platform_xmd_encoded",storageKey:null},p={alias:null,args:null,concreteType:"MessageReaction",kind:"LinkedField",name:"message_reactions",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"reaction",storageKey:null}],storageKey:null},q={alias:null,args:null,kind:"ScalarField",name:"is_sponsored",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"is_user_generated",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"snippet",storageKey:null},t={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"extensible_message_admin_text_type",storageKey:null},s],type:"GenericAdminTextMessage",abstractKey:null},u=[{alias:null,args:null,kind:"ScalarField",name:"text",storageKey:null}],v={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"message",plural:!1,selections:u,storageKey:null},w={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},x={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"file_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"filename",storageKey:null},w],type:"MessageFile",abstractKey:null},y={alias:null,args:null,kind:"ScalarField",name:"uri",storageKey:null},z={alias:null,args:null,kind:"ScalarField",name:"height",storageKey:null},A={alias:null,args:null,kind:"ScalarField",name:"width",storageKey:null},B={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:[y,z,A],storageKey:null},C={kind:"InlineFragment",selections:[B,w],type:"MessageImage",abstractKey:null},D={alias:null,args:null,kind:"ScalarField",name:"playable_url",storageKey:null};B={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"video_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"legacy_attachment_id",storageKey:null},{alias:null,args:null,concreteType:"Vect2",kind:"LinkedField",name:"original_dimensions",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"x",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"y",storageKey:null}],storageKey:null},D,w,B],type:"MessageVideo",abstractKey:null};var E={alias:null,args:null,kind:"ScalarField",name:"unread",storageKey:null},F={alias:null,args:null,kind:"ScalarField",name:"deduplication_key",storageKey:null},G={alias:null,args:null,kind:"ScalarField",name:"style_list",storageKey:null};u={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"source",plural:!1,selections:u,storageKey:null};y=[y,A,z];var H={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:y,storageKey:null};y={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"animated_image",plural:!1,selections:y,storageKey:null};var I={alias:null,args:null,kind:"ScalarField",name:"is_playable",storageKey:null},J={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media",plural:!1,selections:[H,y,I],storageKey:null},K=[g],L={alias:null,args:null,kind:"ScalarField",name:"template_type",storageKey:null},M={alias:null,args:null,kind:"ScalarField",name:"image_width",storageKey:null},N=[g,{alias:null,args:null,kind:"ScalarField",name:"page_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_disabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_mutable_by_server",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cta_render_style",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"action_open_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"action_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"action_title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"logging_token",storageKey:null}],O={alias:null,args:null,concreteType:"MessengerCallToAction",kind:"LinkedField",name:"call_to_actions",plural:!0,selections:N,storageKey:null};N={alias:null,args:null,concreteType:"MessengerCallToAction",kind:"LinkedField",name:"default_action",plural:!1,selections:N,storageKey:null};D={kind:"InlineFragment",selections:[D,z,A,g],type:"Video",abstractKey:null};z={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null};A={alias:null,args:null,kind:"ScalarField",name:"image_url",storageKey:null};var P={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},Q={alias:null,args:null,kind:"ScalarField",name:"first_metaline",storageKey:null},R={alias:null,args:null,kind:"ScalarField",name:"second_metaline",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"third_metaline",storageKey:null},T={alias:null,args:null,kind:"ScalarField",name:"image_aspect_ratio",storageKey:null},U={alias:null,args:null,kind:"ScalarField",name:"target_url",storageKey:null},V={alias:null,args:null,kind:"ScalarField",name:"source_name",storageKey:null},W={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},X={kind:"InlineFragment",selections:K,type:"Node",abstractKey:"__isNode"},Y={kind:"InlineFragment",selections:K,type:"GenericAttachmentMedia",abstractKey:null},Z={kind:"InlineFragment",selections:K,type:"MontageImage",abstractKey:null},$={kind:"InlineFragment",selections:K,type:"MontageVideo",abstractKey:null};H={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media",plural:!1,selections:[W,H,y,I,X,Y,Z,$],storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"LivechatPluginGuestMessageThreadQueryContainerQuery",selections:[{alias:null,args:b,concreteType:"MessageThread",kind:"LinkedField",name:"guest_message_thread",plural:!1,selections:[c,d,e,f,{alias:null,args:null,concreteType:"MessagesOfThreadConnection",kind:"LinkedField",name:"messages",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"nodes",plural:!0,selections:[h,i,j,k,l,m,n,o,p,q,r,t,{kind:"InlineFragment",selections:[v,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_attachments",plural:!0,selections:[x,C,B],storageKey:null},E,{alias:null,args:null,concreteType:"ExtensibleMessageAttachment",kind:"LinkedField",name:"extensible_attachment",plural:!1,selections:[g,{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"story_attachment",plural:!1,selections:[{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"subattachments",plural:!0,selections:[F,G,u,J,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:K,storageKey:null}],storageKey:null},F,G,u,J,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:[g,{kind:"InlineFragment",selections:[L,w,M,s,O,{alias:null,args:null,concreteType:"MessengerBusinessMessageItemsConnection",kind:"LinkedField",name:"business_items",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerRetailItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[O,N,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media_blob_attachments",plural:!0,selections:[D],storageKey:null},z,A,P,Q,R,S,g,T,U,V],storageKey:null}],storageKey:null}],type:"MessengerBusinessMessage",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"UserMessage",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"LivechatPluginGuestMessageThreadQueryContainerQuery",selections:[{alias:null,args:b,concreteType:"MessageThread",kind:"LinkedField",name:"guest_message_thread",plural:!1,selections:[c,d,e,f,{alias:null,args:null,concreteType:"MessagesOfThreadConnection",kind:"LinkedField",name:"messages",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"nodes",plural:!0,selections:[W,h,i,j,k,l,m,n,o,p,q,r,t,{kind:"InlineFragment",selections:[v,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_attachments",plural:!0,selections:[W,x,C,B,X],storageKey:null},E,{alias:null,args:null,concreteType:"ExtensibleMessageAttachment",kind:"LinkedField",name:"extensible_attachment",plural:!1,selections:[g,{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"story_attachment",plural:!1,selections:[{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"subattachments",plural:!0,selections:[F,G,u,H,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:[W,g],storageKey:null}],storageKey:null},F,G,u,H,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:[W,g,{kind:"InlineFragment",selections:[L,w,M,s,O,{alias:null,args:null,concreteType:"MessengerBusinessMessageItemsConnection",kind:"LinkedField",name:"business_items",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerRetailItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[O,N,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media_blob_attachments",plural:!0,selections:[W,D,X,Y,Z,$],storageKey:null},z,A,P,Q,R,S,g,T,U,V],storageKey:null}],storageKey:null}],type:"MessengerBusinessMessage",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"UserMessage",abstractKey:null},X],storageKey:null}],storageKey:null},g],storageKey:null}]},params:{id:"3463783443656965",metadata:{},name:"LivechatPluginGuestMessageThreadQueryContainerQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("MessagingPluginGuestSendTextMessageMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],b=[{kind:"Variable",name:"data",variableName:"input"}],c={alias:null,args:null,kind:"ScalarField",name:"client_mutation_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"timestamp_precise",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"message_id",storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"MessagingPluginGuestSendTextMessageMutation",selections:[{alias:null,args:b,concreteType:"MessagingPluginGuestTextSendResponsePayload",kind:"LinkedField",name:"live_chat_guest_send_text_message",plural:!1,selections:[c,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"message",plural:!1,selections:[d,e],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"MessagingPluginGuestSendTextMessageMutation",selections:[{alias:null,args:b,concreteType:"MessagingPluginGuestTextSendResponsePayload",kind:"LinkedField",name:"live_chat_guest_send_text_message",plural:!1,selections:[c,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"message",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},d,e,{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],type:"Node",abstractKey:"__isNode"}],storageKey:null}],storageKey:null}]},params:{id:"2731433990299077",metadata:{},name:"MessagingPluginGuestSendTextMessageMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("MessengerSharedPhotoReact.bs",["cx","fbt","CssBackgroundImage.react","Link.react","bs_curry","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react"),k={height:"100%"};function a(a){var c=a.className,d=a.fbid,e=a.onClick,f=a.uri;a=a.isSpherical;var g=function(a){a.preventDefault();return b("bs_curry")._1(e,d)},i=h._("\u76f8\u7247");if(f===void 0)return j.jsx(b("Link.react"),{"aria-label":i,className:c,onClick:g,role:"button"});a=a?j.jsx("div",{className:"_3603 _64ks"}):null;return j.jsx(b("Link.react"),{"aria-label":i,className:c,href:f,onClick:g,children:j.jsx(b("CssBackgroundImage.react"),{className:c,imageURI:f,backgroundPosition:"center",style:k,children:a})})}c=a;f.style100pct=k;f.make=c}),null);
__d("MessengerSharedPhotoReact.re",["MessengerSharedPhotoReact.bs"],(function(a,b,c,d,e,f){(function(a){return null});a=b("MessengerSharedPhotoReact.bs").make;f.make=a}),null);
__d("ChatPhotoViewFooterHScroll.react",["cx","Animation","MessengerSharedPhotoReact.re","SphericalPhotoUtils","prop-types","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react"),j=200,k=74,l=140,m=30;a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$1=null,c.state={currentPhoto:"",prevScrollLeft:0,scrollLeft:0},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.componentDidMount=function(){this.props.width&&this.props.updateNumberInOneBatch(this.$2(this.props.width)),this.$1=new(b("Animation"))(this.refs.childContainer).to("scrollLeft",0).duration(j).go()};d.UNSAFE_componentWillReceiveProps=function(a){if(a.photoID!=this.state.currentPhoto||this.props.sharedPhotos.length!==a.sharedPhotos.length){var b=a.width?(a.width-k)/2-l:0,c=a.sharedPhotos.findIndex(function(b){return b.node.id===a.photoID});this.setState({currentPhoto:a.photoID,prevScrollLeft:this.state.scrollLeft,scrollLeft:c*k-b})}a.width!=this.props.width&&this.props.updateNumberInOneBatch(this.$2(a.width))};d.componentDidUpdate=function(){this.$1&&this.$1.from("scrollLeft",this.state.prevScrollLeft).to("scrollLeft",this.state.scrollLeft).duration(j).go()};d.componentWillUnmount=function(){this.$1&&this.$1.stop()};d.shouldComponentUpdate=function(a,b){return a.photoID!=this.state.currentPhoto||a.sharedPhotos.length!==this.props.sharedPhotos.length?!0:!1};d.render=function(){var a=this,c=this.props.sharedPhotos;c=c.map(function(c){var d,e=c.node.photo_encodings?c.node.photo_encodings.length!==0:!1;d=(d=c)!=null?(d=d.node)!=null?(d=d.image1)!=null?d.uri:d:d:d;if(e){var f=b("SphericalPhotoUtils").getThumbnailsFromPhotoEncodings(c.node.photo_encodings);f=f.smallThumbnail;d=f||d}return!d?null:i.jsx("div",{className:"_1oyb",children:i.jsx(b("MessengerSharedPhotoReact.re").make,{className:"_1oyc"+(a.state.currentPhoto!==c.node.id?" _1oyd":""),fbid:c.node.legacy_attachment_id,onClick:a.props.onScroll,uri:d,isSpherical:e})},c.node.legacy_attachment_id)});return i.jsx("div",{className:"_1oye",children:i.jsx("div",{className:"_1oyf",ref:"childContainer",children:i.jsx("div",{className:"_1oyh",ref:"scrollable",children:c})})})};d.$2=function(a){return a?Math.ceil((a-l*2)/k):m};return c}(i.Component);e.exports=a;a.propTypes={onScroll:b("prop-types").func,photoID:b("prop-types").string,sharedPhotos:b("prop-types").array,updateNumberInOneBatch:b("prop-types").func,width:b("prop-types").number}}),null);
__d("XForwardingNUXSeenController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/chat/forwarding_nux_seen/",{})}),null);
__d("MessagingForwardingButtonNUX.react",["AsyncRequest","ChatConfig","XForwardingNUXSeenController","XUIAmbientNUX.react","prop-types","react"],(function(a,b,c,d,e,f){var g,h=g||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.state={showNUX:!b("ChatConfig").get("seen_forwarding_nux")},d.$1=function(){if(!d.state.showNUX)return;b("ChatConfig").set("seen_forwarding_nux",!0);new(b("AsyncRequest"))(b("XForwardingNUXSeenController").getURIBuilder().getURI()).send();d.setState({showNUX:!1})},d.close=function(){d.$1()},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.render=function(){return h.jsx(b("XUIAmbientNUX.react"),{contextRef:this.props.contextRef,onCloseButtonClick:this.$1,position:"left",width:"auto",shown:this.state.showNUX,children:this.props.children})};return c}(h.Component);e.exports=a;a.propTypes={contextRef:b("prop-types").func.isRequired}}),null);
__d("MessengerPhotoViewCloseLinkReact.bs",["cx","fbt","TooltipLink.react","bs_curry","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react");function a(a){var c=a.onClick;a=j.jsx("span",{children:h._("\u6309 Esc \u9375\u95dc\u9589")});return j.jsx(b("TooltipLink.react"),{children:j.jsx("div",{className:"_387s"}),className:"_51ok _50-m _51an",onClick:function(a){return b("bs_curry")._1(c,void 0)},tooltip:a})}c=a;f.make=c}),null);
__d("MessengerPhotoViewCloseLinkReact.re",["MessengerPhotoViewCloseLinkReact.bs"],(function(a,b,c,d,e,f){(function(a){return null});a=b("MessengerPhotoViewCloseLinkReact.bs").make;f.make=a}),null);
__d("SpotlightViewerBottomBarLink",["cx","Link.react","react"],(function(a,b,c,d,e,f,g){var h,i=h||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a=this.props.className||"_4_8j _4_8k";return i.jsx(b("Link.react"),babelHelpers["extends"]({},this.props,{className:a,children:this.props.children}))};return c}(i.Component);e.exports=a}),null);
__d("ChatPhotoViewHeader.react",["cx","fbt","CurrentUser","MessagingForwardingButtonNUX.react","MessengerPhotoViewCloseLinkReact.re","SpotlightViewerBottomBarLink","prop-types","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$3=function(){c.$2(),c.props.showForwardDialog&&c.props.showForwardDialog()},c.$4=function(){c.$2(),c.props.showShareDialog&&c.props.showShareDialog()},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.render=function(){return j.jsxs("div",{className:"_51an _50-m _3h_t _5l-3",role:"banner",children:[this.$1(),j.jsx(b("MessengerPhotoViewCloseLinkReact.re").make,{onClick:this.props.onClose})]})};d.$2=function(){this.refs.forwardNUX&&this.refs.forwardNUX.close()};d.$1=function(){var a=this,c,d,e;this.props.disableForward||(c=j.jsxs(b("SpotlightViewerBottomBarLink"),{className:"_3h_u",onClick:this.$3,ref:"forwardButton",children:[j.jsx("div",{className:"_3h_v _3h_w"}),h._("\u8f49\u5bc4")]}),d=j.jsx(b("MessagingForwardingButtonNUX.react"),{contextRef:function(){return a.refs.forwardButton},ref:"forwardNUX",children:h._("\u4ee5\u500b\u5225\u8a0a\u606f\u7684\u65b9\u5f0f\u767c\u9001\u9019\u5f35\u5716\u50cf\u7d66\u5176\u4ed6\u4eba\u3002")}));this.props.enableShareToFB&&(e=j.jsxs("div",{className:"_3h_u",onClick:this.$4,ref:"shareButton",role:"button",tabIndex:"0",children:[j.jsx("div",{className:"_3tth _3h_w"}),this.$5()]}));return j.jsxs("div",{ref:"buttons",children:[j.jsxs(b("SpotlightViewerBottomBarLink"),{className:"_3h_u",rel:"async",ajaxify:this.props.url,ref:"downloadButton",children:[j.jsx("div",{className:"_3h_x _3h_w"}),h._("\u4e0b\u8f09")]}),c,d,e,j.jsxs("div",{className:"_3h_u",onClick:this.props.openInfo,ref:"moreInfo",role:"link",tabIndex:"0",children:[j.jsx("div",{className:"_3h_y _3h_w"}),h._("\u76f8\u95dc\u8cc7\u8a0a")]})]},"buttonsContainer")};d.$5=function(){if(b("CurrentUser").isWorkUser())return h._("\u5206\u4eab\u5230 Workplace");else return h._("\u5206\u4eab\u5230 Facebook")};return c}(j.PureComponent);e.exports=a;a.propTypes={disableForward:b("prop-types").bool,enableShareToFB:b("prop-types").bool,onClose:b("prop-types").func,openInfo:b("prop-types").func,showForwardDialog:b("prop-types").func,showShareDialog:b("prop-types").func,url:b("prop-types").object}}),null);
__d("XMessagingVideoAttachmentController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mercury/attachments/video/",{video_id:{type:"String",required:!0},video_container_id:{type:"String",required:!0},width:{type:"Int",required:!0},height:{type:"Int",required:!0},start_muted:{type:"Bool",defaultValue:!1},no_fullscreen:{type:"Bool",defaultValue:!1},load_player_controller:{type:"Bool",defaultValue:!1},hide_controls_on_finish:{type:"Bool",defaultValue:!1},hide_url_menu_option:{type:"Bool",defaultValue:!1},is_share:{type:"Bool",defaultValue:!1},render_play_button:{type:"Bool",defaultValue:!1},start_timestamp:{type:"Int",defaultValue:0},native_thumbnail:{type:"Bool",defaultValue:!1}})}),null);
__d("MessengerVideoPlayer.react",["cx","ActorURI","AsyncRequest","BackgroundImage.react","Event","FullScreen","MessengerSpinner.react","ShimButton.react","SpotlightMercurySharedMediaViewer.react","SubscriptionsHandler","Vector","VideoPlayerReasonTransitionHelper","XMessagingVideoAttachmentController","cssURL","getFullScreenElement","guid","joinClasses","prop-types","react","setImmediate"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react"),j="_ox1",k="_27db";a=function(a){babelHelpers.inheritsLoose(c,a);function c(c){var d,e;e=a.call(this,c)||this;e.$2=!0;e.$3=[];e.$4=-1;e.$5=!1;e.$6=!1;e.state={playerAPI:null,forcePause:!!((d=e.props.videoData)==null?void 0:d.disableAutoplay),loaded:!1};e.$10=function(a){if(e.isVideoControlClicked(a)){a.preventDefault();a.stopPropagation();return}if(!e.isVideoClicked(a))return;a.preventDefault();e.props.isOnStage?(a.stopPropagation(),e.isState("playing")?e.pause("user_initiated"):e.play("user_initiated")):(e.pause("user_initiated"),e.props.onClick&&e.props.onClick())};e.$11=function(a){if(!e.isRightClick(a))return;a.stopPropagation();a.preventDefault();b("setImmediate")(function(){e.props.onSelect&&e.props.onSelect()})};e.$8=function(){if(!e.$2||e.state.forcePause)return;e.$6&&(e.play(new(b("VideoPlayerReasonTransitionHelper"))("page_visibility_initiated")),e.$6=!1)};e.$7=function(){if(!e.$2||e.state.forcePause||!(e.state.playerAPI&&e.state.playerAPI.isMuted()))return;e.$6=!!e.state.playerAPI&&e.state.playerAPI.isState("playing");e.pause()};e.$1=b("guid")();e.$2=!((d=c.videoData)==null?void 0:d.disableAutoplay);e.props.isInThread&&(e.listeners=new(b("SubscriptionsHandler"))(),e.listeners.addSubscriptions(b("Event").listen(window,"blur",e.$7),b("Event").listen(window,"focus",e.$8)));return e}var d=c.prototype;d.shouldComponentUpdate=function(a){var c=document.getElementById(this.$1.toString()),d=b("FullScreen").isFullScreen();if(c!=null&&d&&c.children[0].children[0]===b("getFullScreenElement")())return!1;d=!!(a.stageDimensions&&a.stageDimensions!==this.props.stageDimensions);d&&(this.$4=this.getCurrentTimePosition(),this.$5=!this.isState("playing"));return!this.props.videoData||a.videoData.id!==this.props.videoData.id||d};d.UNSAFE_componentWillReceiveProps=function(a){if(!this.$2)return;this.props.isInThread&&a.isVisible!==this.props.isVisible&&(a.isVisible&&!this.state.forcePause?this.play(new(b("VideoPlayerReasonTransitionHelper"))("video_visibility_initiated")):this.pause())};d.componentDidMount=function(){this.props.videoData&&this.$9()};d.componentDidUpdate=function(){this.$3.forEach(function(a){return a.abandon()}),this.$3=[],this.props.videoData&&this.$9()};d.componentWillUnmount=function(){this.pause("unloaded"),this.seek(0),this.$3.forEach(function(a){return a.abandon()}),this.listeners&&this.listeners.release(),this.state.playerAPI&&this.state.playerAPI.detachRootNode(),this.state.playerAPI&&this.state.playerAPI.destroy&&this.state.playerAPI.destroy()};d.isVideoLoaded=function(){var a=!!this.state.playerAPI;!a;return this.isState("fallback")?!1:a};d.isVideoClicked=function(a){return a.target instanceof HTMLElement?a.target.classList.contains(j):!1};d.isVideoControlClicked=function(a){var b=document.getElementsByClassName(k);for(var c=0;c<b.length;c++){var d=a.target;if(b[c].contains(d))return!0}return!1};d.isRightClick=function(a){a=a||window.event;return a.button===2};d.play=function(a){if(!this.isVideoLoaded())return;this.state.playerAPI&&this.state.playerAPI.play(a)};d.pause=function(a){if(!this.isVideoLoaded())return;this.state.playerAPI&&this.state.playerAPI.pause(a)};d.seek=function(a){if(!this.isVideoLoaded())return;this.state.playerAPI&&this.state.playerAPI.seek(a)};d.getCurrentTimePosition=function(){return this.isVideoLoaded()&&this.state.playerAPI?this.state.playerAPI.getCurrentTimePosition():-1};d.render=function(){var a=this.props.videoData,c=i.jsx("div",{ref:"placeholder",children:i.jsx(b("MessengerSpinner.react"),{color:"blue",size:b("MessengerSpinner.react").large_size})}),d={};if(a&&a.url){var e=a.original_dimensions;d.backgroundImage=this.state.loaded?b("cssURL")(a.url):"none";c=i.jsx("div",{ref:"placeholder",children:i.jsx(b("BackgroundImage.react"),{className:this.props.className,width:e.x,height:e.y,loadingIndicatorStyle:"large",backgroundSize:"cover",ref:"placeholder",style:d,src:a.url})})}return i.jsx(b("ShimButton.react"),{className:b("joinClasses")(this.props.className,"_4-od"),id:this.$1,onClick:this.$10,onMouseDown:this.$11,style:d,children:c})};d.$9=function(){var a=this,c=this.props.videoData;if(c){var d=c.original_dimensions;this.props.stageDimensions&&(d=b("SpotlightMercurySharedMediaViewer.react").getImageDimensionsForStage(new(b("Vector"))(c.original_dimensions.x,c.original_dimensions.y),this.props.stageDimensions));d=b("XMessagingVideoAttachmentController").getURIBuilder().setString("video_id",c.legacy_attachment_id).setString("video_container_id",this.$1).setInt("width",d.x).setInt("height",d.y).setInt("start_timestamp",this.$4>0?Math.round(this.$4):0).setBool("start_muted",c.start_muted).setBool("no_fullscreen",c.no_fullscreen).setBool("load_player_controller",!0).setBool("hide_controls_on_finish",c.hide_controls_on_finish).setBool("native_thumbnail",c.disableAutoplay).setBool("hide_url_menu_option",Boolean(c.hide_url_menu_option)).setBool("is_share",c.is_share).setBool("render_play_button",this.props.isInThread).getURI();c=this.props.attachment;c&&c.metadata&&c.metadata.pageid&&(d=b("ActorURI").create(d,c.metadata.pageid));var e=new(b("AsyncRequest"))();this.$3.push(e);e.setMethod("GET").setStatusElement(this.refs.placeholder).setURI(d).setRelativeTo(this).setReadOnly(!0).setHandler(function(b){a.$3=a.$3.filter(function(a){return a!==e})}).send()}};d.$12=function(){this.props.isVisible&&this.isState("finished")?(this.seek(0),this.play("loop_initiated")):this.props.isVisible&&this.isState("paused")&&!this.$6?this.setState({forcePause:!0}):this.isState("playing")&&this.setState({forcePause:!1})};d.onVideoLoaded=function(){var a=this;if(!this.$2)return;this.state.playerAPI&&this.state.playerAPI.addListener("stateChange",function(){return a.$12()});this.props.isVisible&&!this.$5&&!this.state.forcePause?this.play("autoplay_initiated"):this.pause();this.$4=-1;this.$5=!1};d.isState=function(a){return!!(this.state.playerAPI&&this.state.playerAPI.isState(a))};return c}(i.Component);e.exports=a;a.propTypes={attachment:b("prop-types").object,className:b("prop-types").string,isInThread:b("prop-types").bool,isVisible:b("prop-types").bool,isOnStage:b("prop-types").bool,stageDimensions:b("prop-types").instanceOf(b("Vector")),videoData:b("prop-types").object,onClick:b("prop-types").func,onSelect:b("prop-types").func};a.invokeVideoLoaded=function(a,b,c){a.$2=c,b.setAllowCrossPageTransition(!0),b.isState("loading")?a.stateChangeListener=b.addListener("stateChange",function(){if(!b.isState("loading")){if(a.state&&a.state.playerAPI)return;a.setState({playerAPI:b},a.onVideoLoaded);a.stateChangeListener&&a.stateChangeListener.remove()}}):a.setState({playerAPI:b,loaded:!0},a.onVideoLoaded)}}),null);
__d("MessagingForwardAttachmentDialog.react",["BootloadOnRender.react","JSResource","LazyComponent.react","react"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return h.jsx(b("BootloadOnRender.react"),{component:h.jsx(b("LazyComponent.react"),babelHelpers["extends"]({},this.props)),loader:b("JSResource")("MessagingForwardAttachmentDialogImpl.react").__setRef("MessagingForwardAttachmentDialog.react"),placeholder:h.jsx("div",{})})};return c}(h.PureComponent);e.exports=a}),null);
__d("MessengerThreadSharedMediaAfterWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1668947383157276"};b.getQueryID=function(){return"515216185516880"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("MessengerThreadSharedMediaBeforeWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1712143858865110"};b.getQueryID=function(){return"1694317194012102"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("MessengerThreadSharedMediaFindWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1933185426727404"};b.getQueryID=function(){return"237087923629184"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("SpotlightMessagesViewerPagers.react",["cx","fbt","LeftRight.react","Link.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";e.exports=a;var i,j=i||b("react");function a(a){return j.jsxs(b("LeftRight.react"),{children:[j.jsx(b("Link.react"),{"aria-disabled":a.disablePrevArrow,"aria-label":h._("\u4e0a\u4e00\u5f35"),className:"_322u"+(a.disablePrevArrow?"":" _2bbb")+" _50-m",children:j.jsx("div",{className:(a.disablePrevArrow?"":"_4ksl")+(a.disablePrevArrow?"":" _4ksm")})}),j.jsx(b("Link.react"),{"aria-disabled":a.disableNextArrow,"aria-label":h._("\u4e0b\u4e00\u5f35"),className:"_322u"+(a.disableNextArrow?"":" _2bbc")+" _50-m",children:j.jsx("div",{className:(a.disableNextArrow?"":"_4ksl")+(a.disableNextArrow?"":" _4kso")})})]})}}),null);
__d("XMessagingPhotoDownloadController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mercury/attachments/photo/",{photo_id:{type:"String",required:!0}})}),null);
__d("XMessagingShareAttachmentDialogController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mercury/attachments/share/dialog/",{__asyncDialog:{type:"Int"},privacy_mutation_token:{type:"String"}})}),null);
__d("SpotlightMercurySharedMediaViewer.react",["csx","cx","fbt","invariant","ActorURI","AsyncDialog","AsyncRequest","BootloadedComponent.react","ChatPhotoViewFooterHScroll.react","ChatPhotoViewHeader.react","Event","FunnelLogger","JSResource","KeyEventController","MessagingForwardAttachmentDialog.react","MessengerThreadSharedMediaHelper","MessengerVideoPlayer.react","Parent","PhotoUtils","SpotlightMessagesViewerPagers.react","SpotlightViewer","SpotlightViewerImage","SpotlightViewport","SubscriptionsHandler","Vector","XMessagingPhotoDownloadController","XMessagingShareAttachmentDialogController","lazyLoadComponent","prop-types","react"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";var k,l=k||b("react"),m=88,n=30,o="WWW_MESSENGER_SHARE_TO_FB_FUNNEL",p="_4-og";a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.$1=void 0,d.$2=[],d.state={hasPrevPage:!1,hasNextPage:!1,firstPhotoLoaded:!1,isLoading:!1,mediaData:[],numberInOneBatch:n,photoData:null,showForward:!1,showInfo:!1,stageDimensions:new(b("Vector"))()},d.$11=function(){return!d.state.photoData?null:l.jsx(b("ChatPhotoViewFooterHScroll.react"),{onScroll:d.$18,photoID:d.state.photoData.node.id,sharedPhotos:d.state.mediaData,updateNumberInOneBatch:d.$19,width:d.state.stageDimensions.x})},d.$19=function(a){d.setState({numberInOneBatch:a})},d.$18=function(a){if(!d.state.mediaData||d.state.isLoading)return;var b=d.state.mediaData.findIndex(function(b){return b.node.legacy_attachment_id===a});if(b<0)return;var c=d.state.mediaData[b];d.setState({photoData:c});d.$22(b)},d.$5=function(a,c){if(d.state.photoData==null||d.state.isLoading)return;if(c&&!!b("Parent").bySelector(c.target,"._170l"))return;c&&c.target instanceof HTMLElement&&c.target.className===p&&d.$10();c=d.state.mediaData.findIndex(function(a){d.state.photoData!=null||j(0,1033);return a.node.legacy_attachment_id===d.state.photoData.node.legacy_attachment_id});if(c<0||c===d.state.mediaData.length-1&&!d.state.hasNextPage&&a)return;if(c===0&&!a){d.setState({isLoading:!0},function(){return d.$7(d.state.photoData,1,function(b){if(b===0)return;d.$5(a)})});return}var e=a?d.state.mediaData[c+1]:d.state.mediaData[c-1];d.setState({photoData:e});d.$22(c)},d.$10=function(){if(d.props.photoID===null)return;d.setState({photoData:null});d.props.onClosePhotoView()},d.$16=function(){d.setState({showForward:!0})},d.$20=function(){d.setState({showForward:!1})},d.$15=function(){d.setState({showInfo:!0})},d.$21=function(){d.setState({showInfo:!1})},d.$17=function(){d.setState({showForward:!1,showInfo:!1});b("FunnelLogger").appendAction(o,"click");var a=d.state.photoData;if(!d.$14()||!(a&&a.node))return;a=a.node.legacy_attachment_id;var c=b("XMessagingShareAttachmentDialogController").getURIBuilder().getURI();c=new(b("AsyncRequest"))(c).setData({attachment_id:a}).setMethod("POST");b("AsyncDialog").send(c)},d.$23=function(a,b,c){var e=Object.keys(a)[0];a=a[e].message_shared_media;e=a.page_info;var f=a.edges.length;if(f!==0){var g=d.state.mediaData;switch(b){case 0:d.setState({photoData:a.edges[0],mediaData:[a.edges[0]],firstPhotoLoaded:!0});break;case 1:g=g.concat(a.edges);d.setState({hasNextPage:e.has_next_page,mediaData:g});break;case-1:g=a.edges;g=g.concat(d.state.mediaData);d.setState({mediaData:g,hasPrevPage:e.has_previous_page});break}}d.setState({isLoading:!1});c(f)},d.$3=function(){var a=new(b("Vector"))(b("Vector").getViewportDimensions().x,b("Vector").getViewportDimensions().y-m);return a},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.getDefaultProps=function(){return{enableShareToFB:!1}};d.componentDidMount=function(){var a=this;this.setState({isLoading:!0,stageDimensions:this.$3()},function(){return a.$4(a.props.photoID)});this.$1=new(b("SubscriptionsHandler"))();this.$1.addSubscriptions(b("Event").listen(window,"resize",function(){a.setState({stageDimensions:a.$3()})}),b("KeyEventController").registerKey("LEFT",function(){a.$5(!1);return!1}),b("KeyEventController").registerKey("RIGHT",function(){a.$5(!0);return!1}));this.props.enableShareToFB&&b("FunnelLogger").startFunnel(o)};d.UNSAFE_componentWillUpdate=function(a,b){var c=this;b.firstPhotoLoaded!==this.state.firstPhotoLoaded&&this.setState({isLoading:!0},function(){c.$6(b.photoData,b.numberInOneBatch,function(){}),c.$7(b.photoData,b.numberInOneBatch,function(){})});b.numberInOneBatch!=this.state.numberInOneBatch&&!b.isLoading&&this.setState({isLoading:!0},function(){return c.$6(b.mediaData[b.mediaData.length-1],b.numberInOneBatch,function(){})})};d.componentWillUnmount=function(){this.$1&&this.$1.release(),this.$1=null,this.$2.forEach(function(a){return a.abandon()})};d.render=function(){var a=this,c=this.$8(),d=this.state.stageDimensions,e=this.state.isLoading||this.props.useloadingindicator&&!this.state.photoData;if(this.state.photoData==null)return null;var f=this.state.mediaData.findIndex(function(b){a.state.photoData!=null||j(0,1033);return b.node.id===a.state.photoData.node.id});f=l.jsxs("div",{children:[this.$9(),this.props.disablepaging?null:l.jsx(b("SpotlightMessagesViewerPagers.react"),{disablePrevArrow:f<=0&&!this.state.hasPrevPage,disableNextArrow:!this.state.hasNextPage&&f>=this.state.mediaData.length-1})]});return l.jsxs("span",{children:[l.jsxs(b("SpotlightViewer"),{className:"_53vs",onHide:this.$10,open:this.props.photoID!==null,ref:"spotlightViewer",rootClassName:this.props.rootClassName,children:[l.jsx(b("SpotlightViewport"),{active:!1,fadeInNOut:!0,media:c,onClick:this.$5,ref:"viewport",showLoadingIndicator:e,stageDimensions:d,useWidth:!0,children:f}),this.$11()]}),this.$12(),this.$13()]})};d.$9=function(){if(!this.state.photoData)return null;var a=this.state.photoData;a=a.node.legacy_attachment_id;a=b("XMessagingPhotoDownloadController").getURIBuilder().setString("photo_id",a).getURI();this.props.actorid&&(a=b("ActorURI").create(a,this.props.actorid));return l.jsx(b("ChatPhotoViewHeader.react"),{disableForward:this.props.disableForward,enableShareToFB:this.$14(),onClose:this.$10,openInfo:this.$15,ref:"photoviewheader",showForwardDialog:this.$16,showShareDialog:this.$17,url:a})};d.$12=function(){if(!this.state.photoData||!this.state.showForward)return null;var a=i._("\u8f49\u5bc4");return l.jsx(b("MessagingForwardAttachmentDialog.react"),{attachmentID:this.state.photoData.node.legacy_attachment_id,onClose:this.$20,shown:this.state.showForward,title:a})};d.$13=function(){return this.state.showInfo?l.jsx(l.Suspense,{fallback:l.jsx("div",{}),children:l.jsx(q,{closeInfo:this.$21,infoOpen:this.state.showInfo,photoID:this.state.photoData.node.id})}):l.jsx("xhp",{})};d.$14=function(){var a=this.state.photoData;return!a?!1:!!this.props.enableShareToFB&&a.node.__typename==="MessageImage"&&a.node.image1.uri.indexOf(".gif")<0};d.$22=function(a){var b=this,c=this.state.numberInOneBatch,d=this.state.mediaData;a<=c/2?this.setState({isLoading:!0},function(){return b.$7(d[0],c,function(){})}):a>=d.length-c/2&&this.state.hasNextPage&&this.setState({isLoading:!0},function(){return b.$6(d[d.length-1],c,function(){})})};d.$4=function(a){var c=this;a=b("MessengerThreadSharedMediaHelper").search(this.props.threadID,String(a),function(a){return c.$23(a,0,function(){})});this.$2.push(a)};d.$6=function(a,c,d){var e=this;a=b("MessengerThreadSharedMediaHelper").loadMorePrevious(this.props.threadID,a.cursor,c||1,function(a){return e.$23(a,1,d)});this.$2.push(a)};d.$7=function(a,c,d){var e=this;a=a?a.cursor:null;a=b("MessengerThreadSharedMediaHelper").loadMoreLatest(this.props.threadID,a,c||1,function(a){return e.$23(a,-1,d)});this.$2.push(a)};d.$8=function(){if(this.state.photoData&&this.state.photoData.node){var a=this.state.photoData.node;if(a.__typename&&a.__typename==="MessageVideo")return this.$24();var d=this.state.stageDimensions,e=this.$25(a,d);if(!e)return null;if(a.photo_encodings&&a.photo_encodings.length!==0)return this.$26(a.legacy_attachment_id,e,a.photo_encodings,d);a=c.getImageDimensionsForStage(new(b("Vector"))(e.width,e.height),d);return this.$27(e,a)}else return null};d.$24=function(){return this.state.photoData?l.jsx(b("MessengerVideoPlayer.react"),{isOnStage:!0,isVisible:!0,videoData:this.state.photoData.node,stageDimensions:this.state.stageDimensions}):null};d.$27=function(a,c){return l.jsx(b("SpotlightViewerImage"),{dimensions:c,ref:"image",src:a.uri})};d.$26=function(a,c,d,e){return l.jsx(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SpotlightViewerSphericalPhoto.react").__setRef("SpotlightMercurySharedMediaViewer.react"),bootloadPlaceholder:l.jsx("div",{}),height:e.y,width:e.x,fbid:a,thumbnail:c.uri,photoEncodings:d,stageDimensions:this.state.stageDimensions})};d.$25=function(a,c){var d=null;a=b("PhotoUtils").getImagesFromData(a);a=a.sort(function(a,b){return a.width==null?b.width==null?0:1:b.width==null?-1:b.width-a.width});window.devicePixelRatio&&window.devicePixelRatio>1&&(c=new(b("Vector"))(c.x*window.devicePixelRatio,c.y*window.devicePixelRatio));for(var e=0;e<a.length;e++)(!d||a[e].width>=c.x||a[e].height>=c.y)&&(d=a[e]);return d};return c}(l.Component);e.exports=a;a.propTypes={disableForward:b("prop-types").bool,enableShareToFB:b("prop-types").bool,onClosePhotoView:b("prop-types").func,photoID:b("prop-types").string,rootClassName:b("prop-types").string,threadID:b("prop-types").string};a.getImageDimensionsForStage=function(a,c){var d=a.x;a=a.y;var e=c.x;c=c.y;var f=d/a,g=e/c;d>=e||a>=c?g<f?(d=e,a=Math.round(e/f)):g>f?(d=Math.round(c*f),a=c):(d=e,a=c):f<g?d=Math.round(a*f):a=Math.round(d/f);return new(b("Vector"))(d,a)};var q=b("lazyLoadComponent")(b("JSResource")("MessengerPhotoInfoDialogContainer.react").__setRef("SpotlightMercurySharedMediaViewer.react"))}),null);
__d("MessengerScrollableArea.react",["cx","ReactDOM","ScrollableArea.react","Style","UserAgent","clearImmediate","gkx","joinClasses","react","setImmediate","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react"),j=20,k=b("gkx")("1094116");a=function(a){babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this,c)||this;d.$1=!1;d.$2=null;d.$5=function(){if(d.$1){var a;d.props.onScroll&&(a=d.props).onScroll.apply(a,arguments)}};d.$6=function(){if(!b("UserAgent").isBrowser("IE"))return;if(k)return;if(!d.refs||!d.$4.current)return;var a=d.$4.current.refs.wrap,c=d.$4.current.refs.body;if(!c||!a)return;c=b("ReactDOM").findDOMNode(c);a=b("ReactDOM").findDOMNode(a);a=a.offsetWidth-a.clientWidth;a>0&&b("Style").set(c,"margin-right",-a+"px")};d.$3=b("throttle")(d.$5,50);d.$4=i.createRef();return d}var d=c.prototype;d.componentDidMount=function(){this.$2=b("setImmediate")(this.$6),this.$1=!0};d.componentWillUnmount=function(){b("clearImmediate")(this.$2),this.$1=!1};d.render=function(){var a=this.props.needsFastScrollHandler?this.$5:this.$3;return i.jsx(b("ScrollableArea.react"),{className:b("joinClasses")("_5f0v",this.props.className),height:this.props.height,onClick:this.props.onClick,onScroll:a,persistent:!0,ref:this.$4,shadow:!1,tabIndex:this.props.tabIndex,width:this.props.width,children:this.props.children})};d.getArea=function(){if(this.$4.current)return this.$4.current.getArea()};d.scrollToBottom=function(a){var b=this.getArea();b&&this.scrollToPosition(b.getScrollHeight(),!!a)};d.scrollToTop=function(a){var b=this.getArea();b&&b.scrollToTop(!!a)};d.scrollToPosition=function(a,b,c){b===void 0&&(b=!1);c===void 0&&(c={});var d=this.getArea();if(!d)return;d.setScrollTop(a,b,c)};d.isScrolledToBottom=function(){return this.isScrolledToBottomWithHeight(0)};d.isScrolledToBottomWithHeight=function(a){var b=this.getArea();return!b?!1:b.getScrollTop()+b.getClientHeight()+a>=b.getScrollHeight()-j};d.isScrolledToTop=function(){var a=this.getArea();return!a?!0:a.getScrollTop()<=j};d.getScrollTop=function(){var a=this.getArea();return!a?0:a.getScrollTop()};return c}(i.Component);e.exports=a}),null);
__d("WorkChatRedesignedMessageListCheck.bs",["CurrentUser","MessengerEnvironment","gkx"],(function(a,b,c,d,e,f){"use strict";a=b("gkx")("895574")&&b("CurrentUser").isWorkUser()&&b("MessengerEnvironment").messengerui;f.enabled=a}),null);
__d("MessengerDateBreak.bs",["cx","FBLogger","WorkChatRedesignedMessageListCheck.bs","formatDate","joinClasses","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");function a(a){var c=a.date;a=a.className;a=a!==void 0?a:"";try{var d={today:"g:ia",thisYear:"M jS, g:ia",withinWeek:"D g:ia",older:"m/d/Y g:ia",future:"g:ia"};c=b("formatDate")(c,d);return i.jsx("h4",{className:b("joinClasses")(a,"_497p"+(b("WorkChatRedesignedMessageListCheck.bs").enabled?" _7w5v":"")+(b("WorkChatRedesignedMessageListCheck.bs").enabled?" _7w78":"")+" _2lpt"),children:i.jsx("time",{className:"_3oh-",children:c})})}catch(a){b("FBLogger")("messaging").mustfix("invalid timestamp: Js.Date.getTime(date)");return null}}c=i.memo(a,function(a,b){return a.date.getTime()===b.date.getTime()});f.make=c}),null);
__d("MessengerDateBreak.re",["MessengerDateBreak.bs"],(function(a,b,c,d,e,f){(function(a){return null});a=b("MessengerDateBreak.bs").make;f.make=a}),null);
__d("MessengerDeliveryReceipt.bs",["bs_belt_MapString","bs_belt_Option"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("bs_belt_Option").getWithDefault(b("bs_belt_MapString").get(a,c),0)}c=b("bs_belt_Option").getWithDefault;f.$pipe$question=c;f.getDeliveryTimeOfThread=a}),null);
__d("EmojiOnlyMessage.react",["cx","EmojiImageURL","EmojiLikeConstants","FBEmojiResource","Image.react","MessengerHotlikeEmoji.bs","prop-types","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a="_1ift _1ifu",c=0,d=this.props.contents.map(function(d){c++;var e=d.emojiKey;if(e){e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(e)?b("EmojiImageURL").getMessengerURL(e,b("EmojiLikeConstants").sizeMap.dp32):new(b("FBEmojiResource"))(e).getImageURL(b("EmojiLikeConstants").sizeMap.dp32);return i.jsx(b("Image.react"),{alt:d.text,className:a,src:e},c)}else return i.jsx("span",{children:d.text},c)});return i.jsx("div",{tabIndex:"0",children:d})};return c}(i.Component);e.exports=a;a.propTypes={contents:b("prop-types").arrayOf(b("prop-types").shape({emojiKey:b("prop-types").string,text:b("prop-types").string.isRequired})).isRequired}}),null);
__d("LinkCTAXMATAsyncLink.react",["AsyncRequest","FDSLink.react","react"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.onClick=function(){new(b("AsyncRequest"))().setURI(d.props.uri).setMethod("POST").send()},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.render=function(){return h.jsx(b("FDSLink.react"),{onClick:this.onClick,children:this.props.text})};return c}(h.Component);e.exports=a}),null);
__d("MercuryMessageStore",["CurrentUser","LogHistory","MercuryAPIArgsSource","MercuryMessagingLightswitch","MercuryThreadInformer","MercuryThreadlistConstants","MessengerState.bs","SubscriptionsHandler","mixInEventEmitter","setImmediate"],(function(a,b,c,d,e,f){"use strict";var g=b("LogHistory").getInstance("mercury_message_store");a=function(){function a(a,c,d){var e=this;this.$5=a;this.$1=d||b("CurrentUser").getID();this.$2=1;this.$3=c||b("MercuryThreadlistConstants").RECENT_MESSAGES_LIMIT;this.$6=d?b("MercuryThreadInformer").getForFBID(d):b("MercuryThreadInformer").get();this.$4=new(b("SubscriptionsHandler"))();this.$4.addSubscriptions(this.$6.subscribe("messages-received",function(a,b){return e.$7(b)}),this.$6.subscribe("messages-updated",function(a,b){return b[e.$5]&&e.$8(b[e.$5])}),this.$6.subscribe("messages-deleted",function(a,b){return b[e.$5]&&e.$9(b[e.$5])}),this.$6.subscribe("messages-reordered",function(a,b){return b[e.$5]&&e.$10()}),this.$6.subscribe("thread-invalidated",function(a,b){return b[e.$5]&&e.$11()}));var f=this.$12();b("MercuryMessagingLightswitch").guard(function(){g.debug("constructed",JSON.stringify({threadID:e.$5,messageCount:f}))});f<this.$3?this.$13():b("setImmediate")(function(){e.$10()})}var c=a.prototype;c.destroy=function(){var a=this;this.$4&&this.$4.release();this.removeAllListeners();b("MercuryMessagingLightswitch").guard(function(){g.debug("destroyed",JSON.stringify({threadID:a.$5}))})};c.subscribe=function(a){return this.addRetroactiveListener("updated",a)};c.fetchMoreMessages=function(){if(this.hasFetchedAll())return!1;this.$13();return!0};c.hasFetchedAll=function(){return b("MessengerState.bs").hasLoadedAllMessages(this.$1,this.$5)||b("MessengerState.bs").isNewEmptyLocalThread(this.$1,this.$5)};c.$12=function(){return b("MessengerState.bs").getCurrentlyLoadedMessages(this.$1,this.$5).length};c.$13=function(){var a=this,c=this.$3;b("MessengerState.bs").getThreadMessagesRange(this.$1,this.$5,this.$12(),c,this.$14.bind(this),null,b("MercuryAPIArgsSource").MERCURY);this.$2<10&&(this.$2+=1);b("MessengerState.bs").hasLoadedNMessages(this.$1,this.$5,c+this.$12())&&b("setImmediate")(function(){a.$10()})};c.$14=function(c){var d=this;b("MercuryMessagingLightswitch").guard(function(){g.debug("fetch_messages",JSON.stringify({threadID:d.$5,fetchedMessagesCount:c&&c.length||0,messageCount:d.$12()}))});c&&!c.length&&!this.$12()&&this.$15(a.THREAD_IS_EMPTY)};c.$7=function(b){var c=[];b=b[this.$5];b&&b.length&&(c=c.concat(b.filter(function(a){return!!a})));c.length&&this.$15(a.MESSAGES_RECEIVED)};c.$8=function(b){this.$15(a.MESSAGES_CHANGED)};c.$9=function(b){this.$15(a.MESSAGES_DELETED,b)};c.$10=function(){this.$15(a.MESSAGES_REORDERED)};c.$11=function(){this.$2=1,this.$13()};c.$15=function(a,c){var d=b("MessengerState.bs").getCurrentlyLoadedMessages(this.$1,this.$5);this.releaseHeldEventType("updated");this.emitAndHold("updated",{messages:d,deletedMessages:c,eventType:a})};return a}();e.exports=a;Object.assign(a,{MESSAGES_FETCHED:"fetched",MESSAGES_CHANGED:"changed",MESSAGES_RECEIVED:"received",MESSAGES_REORDERED:"reordered",MESSAGES_DELETED:"deleted",THREAD_IS_EMPTY:"thread-is-empty"});b("mixInEventEmitter")(a,{updated:!0})}),null);
__d("PagesMessagingPerfTypedLogger",["Banzai","GeneratedLoggerUtils"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var c=a.prototype;c.log=function(a){b("GeneratedLoggerUtils").log("logger:PagesMessagingPerfLoggerConfig",this.$1,b("Banzai").BASIC,a)};c.logVital=function(a){b("GeneratedLoggerUtils").log("logger:PagesMessagingPerfLoggerConfig",this.$1,b("Banzai").VITAL,a)};c.logImmediately=function(a){b("GeneratedLoggerUtils").log("logger:PagesMessagingPerfLoggerConfig",this.$1,{signal:!0},a)};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setEventName=function(a){this.$1.event_name=a;return this};c.setExceptionCode=function(a){this.$1.exception_code=a;return this};c.setExceptionMessage=function(a){this.$1.exception_message=a;return this};c.setPageID=function(a){this.$1.page_id=a;return this};c.setPerfTime=function(a){this.$1.perf_time=a;return this};c.setPlatform=function(a){this.$1.platform=a;return this};c.setStack=function(a){this.$1.stack=a;return this};c.setThreadID=function(a){this.$1.thread_id=a;return this};c.setThreadOffset=function(a){this.$1.thread_offset=a;return this};return a}();c={event_name:!0,exception_code:!0,exception_message:!0,page_id:!0,perf_time:!0,platform:!0,stack:!0,thread_id:!0,thread_offset:!0};e.exports=a}),null);
__d("PagesManagerInboxLogger",["PagesManagerInboxTypedLogger","PagesMessagingInboxActionsTypedLogger","PagesMessagingPerfTypedLogger","keyMirror"],(function(a,b,c,d,e,f){"use strict";f.init=a;f.logInitialListRendered=c;f.create=l;f.logErrorJS=d;f.logErrorGraphQL=e;f.startLoadingItem=m;f.itemInitialDataLoaded=n;f.startLoadingItemDetails=o;f.itemDetailsLoaded=p;f.startLoadingThread=q;f.threadDetailsLoaded=r;f.itemRendered=s;f.logBroadcastMessageFormat=t;f.itemStatusChanged=u;f.itemStatusChangedInThread=v;f.itemStatusChangedInHeader=w;f.logFolderChangeClick=x;f.logPlatformChangedClicked=y;f.logSendComment=z;f.logMarkAsUnread=A;f.logCommentReaction=B;f.logSendMessage=C;f.logReceiveMessage=D;f.logSearchClick=E;f.logContentSearchClicked=F;f.logBroadcastButtonRendered=G;f.logBroadcastButtonClicked=H;f.logBroadcastSendButtonClicked=I;f.logBroadcastConfirmationButtonClicked=J;f.logBroadcastHistoryRowClicked=K;f.logAutomatedResponsesRendered=L;f.logAutomatedResponsesEnabled=M;f.logAutomatedResponsesDisabled=N;f.logAutomatedResponsesSaveClicked=O;var g=b("keyMirror")({ERROR_GRAPH_QL:null,ERROR_JS:null,INITIAL_DATA_LOADED:null,INITIAL_LIST_RENDERED:null,INITIAL_LOAD:null,ITEM_DETAILS_LOADED:null,ITEM_LOADED:null,START_LOADING_ITEM_DETAILS:null,START_LOADING_ITEM:null,BROADCAST_MESSAGE_FORMAT:null,ITEM_STATUS_CHANGED:null,ITEM_STATUS_CHANGED_THREAD:null,ITEM_STATUS_CHANGED_HEADER:null,FOLDER_CHANGE_CLICKED:null,PLATFORM_CHANGE_TAB_CLICKED:null,SEND_COMMENT:null,SEND_MESSAGE:null,SEARCH_CLICKED:null,CONTENT_SEARCH_CLICKED:null,CREATE_BROADCAST_BUTTON_RENDERED:null,CREATE_BROADCAST_BUTTON_CLICKED:null,SEND_BROADCAST_BUTTON_CLICKED:null,SEND_BROADCAST_CONFIRM_BUTTON_CLICKED:null,BROADCAST_HISTORY_ROW_CLICK:null,AUTOMATED_RESPONSES_ENTRYPOINT_RENDERED:null,AUTOMATION_ENABLED:null,AUTOMATION_DISABLED:null,AUTOMATED_RESPONSES_SAVE_CLICK:null}),h,i,j=!0,k;function a(a){h=a,i=Date.now(),l(g.INITIAL_LOAD).setScreenHeight(screen.height).setScreenWidth(screen.width).log()}function c(a,b){if(!j)return;j=!1;l(g.INITIAL_LIST_RENDERED).setTimeSinceLoad(Date.now()-i).setPlatform(a).log()}function l(a){return new(b("PagesManagerInboxTypedLogger"))().setEventName(a).setPageID(h).setHref(window.location.href)}function d(a,b){l(g.ERROR_JS).setMessage(a.message).setStackTrace(a.stack).setModuleName(b).log()}function e(a){l(g.ERROR_GRAPH_QL).setMessage(a.message).setStackTrace(a.stack).log()}function m(a,b){if(k&&k.commItemID===a)return;k={commItemID:a,isCached:!0,startTimestamp:Date.now()};l(g.START_LOADING_ITEM).setPageCommItemID(a).setFolder(b).log()}function n(a){if(!k||k.commItemID!==a)return;l(g.INITIAL_DATA_LOADED).setPageCommItemID(a).setLoadTime(Date.now()-k.startTimestamp).log()}function o(a,b){if(!k||k.commItemID!==a)return;k.platform=b;k.isCached=!1;l(g.START_LOADING_ITEM_DETAILS).setPageCommItemID(a).setPlatform(b).setLoadTime(Date.now()-k.startTimestamp).log()}function p(a,b){if(!k||k.commItemID!==a)return;l(g.ITEM_DETAILS_LOADED).setPageCommItemID(a).setPlatform(b).setLoadTime(Date.now()-k.startTimestamp).log()}function q(a,c){if(k&&k.commItemID===a)return;k={commItemID:a,isCached:!0,startTimestamp:Date.now()};l(g.START_LOADING_ITEM).setThreadToken(a).setPlatform(c).log();new(b("PagesMessagingPerfTypedLogger"))().setPageID(h).setThreadID(a).setPlatform(c).setEventName("messages_messagelist_load_start").log()}function r(a,c){if(!k||k.commItemID!==a)return;var d=Date.now()-k.startTimestamp;l(g.ITEM_DETAILS_LOADED).setThreadToken(a).setPlatform(c).setLoadTime(d).log();new(b("PagesMessagingPerfTypedLogger"))().setPageID(h).setThreadID(a).setPlatform(c).setEventName("messages_messagelist_load_end").setPerfTime(d).log();k=null}function s(a){if(!k||k.commItemID!==a)return;l(g.ITEM_LOADED).setIsCached(k.isCached).setPageCommItemID(a).setLoadTime(Date.now()-k.startTimestamp).setPlatform(k.platform).log();k=null}function t(a){l(g.BROADCAST_MESSAGE_FORMAT).setBroadcastMessageFormat(a).log()}function u(a,b,c,d){d=d||null;l(g.ITEM_STATUS_CHANGED).setPageCommItemID(a).setPageCommItemStatus(c).setPlatform(b).setPageCommSearchType(d).log()}function v(a,b,c,d,e){e=e||null;l(g.ITEM_STATUS_CHANGED_THREAD).setFolder(d).setPageCommItemID(a).setPageCommItemStatus(c).setPlatform(b).setPageCommSearchType(e).log()}function w(a,b,c,d){l(g.ITEM_STATUS_CHANGED_HEADER).setFolder(d).setPageCommItemID(a).setPageCommItemStatus(c).setPlatform(b).log()}function x(a,b){l(g.FOLDER_CHANGE_CLICKED).setFolder(b).setPlatform(a).log()}function y(a,b){l(g.PLATFORM_CHANGE_TAB_CLICKED).setPlatform(a).setViewMode(b).log()}function z(a,c,d,e){d===void 0&&(d=null),e===void 0&&(e=null),new(b("PagesMessagingInboxActionsTypedLogger"))().setInboxAction("send_comment").setPlatform(a).addToExtraData("page_id",c).addToExtraData("comment_fbid",d).addToExtraData("post_fbid",e).log(),l(g.SEND_COMMENT).setPlatform(a).log()}function A(a,c){new(b("PagesMessagingInboxActionsTypedLogger"))().setPlatform(a).setInboxAction("mark_as_unread").addToExtraData("page_id",c).log()}function B(a,c,d,e,f){new(b("PagesMessagingInboxActionsTypedLogger"))().setInboxAction("reaction").setPlatform(a).addToExtraData("page_id",c).addToExtraData("comment_fbid",d).addToExtraData("post_fbid",e).addToExtraData("reaction_type",f).log()}function C(a,c,d,e){new(b("PagesMessagingInboxActionsTypedLogger"))().setInboxAction("send_message").setPlatform(a).addToExtraData("page_id",c).addToExtraData("enter_to_send_enabled",d.toString()).log(),l(g.SEND_MESSAGE).setPlatform(a).setFolder(e).log()}function D(a,c){new(b("PagesMessagingInboxActionsTypedLogger"))().setInboxAction("receive_message").setPlatform(a).addToExtraData("page_id",c).log()}function E(a,b){l(g.SEARCH_CLICKED).setPageCommSearch(a).setPlatform(b).log()}function F(a,b){l(g.CONTENT_SEARCH_CLICKED).setPageCommSearchType(a).setPageCommSearch(b).log()}function G(){l(g.CREATE_BROADCAST_BUTTON_RENDERED).log()}function H(){l(g.CREATE_BROADCAST_BUTTON_CLICKED).log()}function I(a){l(g.SEND_BROADCAST_BUTTON_CLICKED).setBroadcastAudience(a).log()}function J(){l(g.SEND_BROADCAST_CONFIRM_BUTTON_CLICKED).log()}function K(){l(g.BROADCAST_HISTORY_ROW_CLICK).log()}function L(){l(g.AUTOMATED_RESPONSES_ENTRYPOINT_RENDERED).log()}function M(a){l(g.AUTOMATION_ENABLED).setAutomatedResponseTriggerType(a).log()}function N(a){l(g.AUTOMATION_DISABLED).setAutomatedResponseTriggerType(a).log()}function O(a,b){l(g.AUTOMATED_RESPONSES_SAVE_CLICK).setAutomatedResponseTriggerType(a).setHadError(b).log()}}),null);
__d("MercurySyncNewMessageTransformer",["Bootloader","FBIDCheck","IrisProtocolMessageLifetime","MercuryIDs","MercuryMessageCustomizations","MercuryProfileRanges","MessageThreadReadState","MessageThreadReadStateEffect","MessageUnsendabilityStatus.bs","MessengerRealtimeAttachmentTransformer.bs","PageCommItemStatus","PagesManagerInboxLogger"],(function(a,b,c,d,e,f){"use strict";var g=b("MessageThreadReadStateEffect").extractThreadStateEffectFromDelta,h=function(a){var b={};try{b=JSON.parse(a)}catch(a){}return b};function a(a,c){var d=parseInt(c.messageMetadata.timestamp,10),e=c.messageMetadata.skipBumpThread,f=g(a,c),i=f===b("MessageThreadReadState").MARK_UNREAD&&a!==c.messageMetadata.actorFbId.toString(),j=c.messageMetadata.messageId,k=[];c.attachments&&(k=c.attachments.map(function(c){var d;c.mercury?d=c.mercury:d=h(c.mercuryJSON);if(!d)return null;c=d.extensible_attachment;var e=d.blob_attachment;d=d.sticker_attachment;if(!c&&!e&&!d)return null;var f=b("FBIDCheck").isUser_deprecated(a);c?c=b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:c},j,f):e?c=b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{blob_attachments:[e]},j,f):c=b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{sticker:d},j,f);return c.length>0?c[0]:null}));var l=!b("FBIDCheck").isUser_deprecated(a);l&&c.messageMetadata.actorFbId!=a&&b("Bootloader").loadModules(["PagesCommsInboxFunnel","PagesCommsInboxLoggerEvent","PagesCommsInboxLoggerPlatform"],function(c,d,e){b("PagesManagerInboxLogger").logReceiveMessage("MESSENGER",a)},"MercurySyncNewMessageTransformer");k=k.filter(Boolean);var m=c.messageMetadata.tags?c.messageMetadata.tags[0]:void 0,n=null;if(c.data&&c.data.adminSignatureCreatorID){var o=c.data;n={creatorID:o.adminSignatureCreatorID||null,creatorName:o.adminSignatureCreatorName||null,creatorType:o.adminSignatureCreatorType||null,labelType:o.adminSignatureLabelType||null,pageID:o.adminSignaturePageID||null,profileURI:o.adminSignatureProfileURI||null}}return{message_id:j,threading_id:null,offline_threading_id:c.messageMetadata.offlineThreadingId,author:b("MercuryIDs").getParticipantIDFromUserID(c.messageMetadata.actorFbId),author_email:c.messageMetadata.actorFbId+"@facebook.com",ephemeral_ttl_mode:c.ttl?b("IrisProtocolMessageLifetime")[c.ttl]:0,timestamp:d,is_unread:i,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,source:m,tags:c.messageMetadata.tags,is_spoof_warning:!1,folder:null,thread_fbid:c.messageMetadata.threadKey.threadFbId,other_user_fbid:c.messageMetadata.threadKey.otherUserFbId,body:c.body!==void 0?c.body:"",html_body:null,subject:null,has_attachment:k.length>0,attachments:k,ranges:void 0,thread_id:null,action_type:"ma-type:user-generated-message",is_from_iris:!0,is_sponsored:!!(c.data&&c.data.is_sponsored&&c.data.is_sponsored==="true")||!!(c.untypedData&&c.untypedData.is_sponsored&&c.untypedData.is_sponsored==="true"),commerce_message_type:c.data?c.data.commerce_message_type:null,customizations:c.data&&c.data.customization?b("MercuryMessageCustomizations").parseCustomizations(c.data.customization):null,platform_xmd:c.data&&c.data.platform_xmd?c.data.platform_xmd:null,profile_ranges:b("MercuryProfileRanges").extractFromDelta(c),message_source:c.data&&c.data.message_source_data?h(c.data.message_source_data).message_source:null,skip_bump_thread:e,thread_read_state_effect:f,montage_reply_data:c.data&&c.data.montage_reply_data?h(c.data.montage_reply_data):null,meta_ranges:c.data&&c.data.meta_ranges?h(c.data.meta_ranges):null,creator_info:n,comm_status:l?b("PageCommItemStatus").TODO:null,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(c.messageMetadata.unsendType)}}e.exports={transform:a}}),null);
__d("MercuryMessagePayload",[],(function(a,b,c,d,e,f){"use strict"}),null);
__d("MercuryAttachmentLayoutTypeHelper",[],(function(a,b,c,d,e,f){"use strict";f.isAdminType=a;function a(a){var b;return(a==null?void 0:(b=a.xma_layout_info)==null?void 0:b.layout_type)==="ADMIN"||(a==null?void 0:(b=a.share)==null?void 0:(a=b.xma_layout_info)==null?void 0:a.layout_type)==="ADMIN"}}),null);
__d("MercuryMessageGroup",["MercuryAttachmentLayoutTypeHelper","MercuryShareAttachmentRenderLocations","MercuryThreadlistConstants","MessengerLightweightActionUtils","MessengerMessage.bs","enumerate"],(function(a,b,c,d,e,f){"use strict";var g={calculateMessageGroups:function(a,c){var d=[],e=null,f={value:null};a=b("enumerate")(a);var h;while(!(h=a.next()).done){var i=g.canAppendMessageToLastGroup(f.value,h.value,c);i||(e=[],d.push(e));e.push(h.value);f=h}return d},canAppendMessageToLastGroup:function(a,c,d){var e=b("MercuryThreadlistConstants").GROUPING_THRESHOLD;if(!a||h(a,d)||h(c,d)||a.author!=c.author||a.timestamp<c.timestamp-e||a.is_spoof_warning!==c.is_spoof_warning||a.page_admin_notes||c.replied_to_message||c.is_forwarded)return!1;d=b("MessengerMessage.bs").getPersona(a);e=b("MessengerMessage.bs").getPersona(c);return!d&&!e?!0:d===null||e===null?!1:d.id===e.id}};function h(a,c){var d=a.has_attachment;d&&(c===b("MercuryShareAttachmentRenderLocations").MESSENGER||c===b("MercuryShareAttachmentRenderLocations").CHAT)&&(d=i(a));return!!(b("MessengerLightweightActionUtils").isLWAMessage(a)||a.action_type=="ma-type:log-message"||d||a.html_body||a.body&&a.body.length>b("MercuryThreadlistConstants").MAX_CHARS_BEFORE_BREAK)}function i(a){a=a.attachments[0];return!a||a.attach_type==="sticker"||a.attach_type==="animated_image"||b("MercuryAttachmentLayoutTypeHelper").isAdminType(a)}e.exports=g}),null);
__d("MessengerBusinessQuickReplyLocationQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"2269337216466106"};b.getQueryID=function(){return"489792994894664"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("MessengerUserProfileLocationUtils",["MessengerBusinessQuickReplyLocationQueryWebGraphQLQuery","MessengerUserProfileLocationUtilsQuery.graphql","RelayFBEnvironment","RelayHooks","WebGraphQL"],(function(a,b,c,d,e,f){"use strict";f.FetchMessengerUserRegionAndPostalCode=a;var g;function h(){return b("RelayHooks").fetchQuery(b("RelayFBEnvironment"),g!==void 0?g:g=b("MessengerUserProfileLocationUtilsQuery.graphql"),{}).toPromise()}function a(){return h().then(function(a){var c=null,d=null;a=a==null?void 0:(a=a.viewer)==null?void 0:(a=a.user)==null?void 0:a.address;a!==null&&(c=(a==null?void 0:a.region)===""?null:a==null?void 0:a.region,d=(a==null?void 0:a.postal_code)===""?null:a==null?void 0:a.postal_code);if(c!==null&&d!==null)return{region:c,postal_code:d};else return b("WebGraphQL").exec(new(b("MessengerBusinessQuickReplyLocationQueryWebGraphQLQuery"))({})).then(function(a){a=(a=a)!=null?a.in_thread_user_fuzzy_location_search:a;if(a!==null){var b;c=c===null?(b=a)!=null?b.state:b:c;d=d===null?(b=a)!=null?b.zip_code:b:d}return{region:c,postal_code:d}})})}}),null);
__d("LiveChatPluginTypingIndicator.react",["cx","Image.react","MercuryTypingAnimation_DEPRECATED.react","MessagingPluginContext","PrivacyTransparentOverlay.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return this.props.pageIsTyping?i.jsxs("div",{className:"_4xkn clearfix",children:[i.jsx("div",{className:"profilePictureColumn",children:i.jsx(b("PrivacyTransparentOverlay.react"),{children:i.jsx(b("Image.react"),{className:"profilePicture",src:this.context.state.pageProfilePictureUri})})}),i.jsx("div",{className:"messages",children:i.jsx("div",{className:"_4xko _13y8",children:i.jsx(b("MercuryTypingAnimation_DEPRECATED.react"),{})})})]}):null};return c}(i.Component);e.exports=a;a.contextType=b("MessagingPluginContext")}),null);
__d("LiveChatPluginFileAttachment.react",["cx","Link.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return i.jsxs(b("Link.react"),{className:"_6d5w _6d5x",target:"_blank",href:this.props.attachment.url,children:[i.jsx("div",{className:"_6d5y"+(this.props.isFromViewer?"":" _6d5z")+(this.props.isFromViewer?" _6d5-":"")}),this.props.attachment.name]})};return c}(i.PureComponent);e.exports=a}),null);
__d("LiveChatPluginLinkShareAttachment.react",["cx","CssBackgroundImage.react","LineClamp.react","Link.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return i.jsxs(b("Link.react"),{className:"_6bxn",href:this.props.uri,target:"_blank",children:[this.$1(),i.jsxs("div",{className:"_6j2g",children:[this.$2(),this.$3(),this.$4()]})]})};d.$1=function(){return this.props.image!=null?i.jsx(b("CssBackgroundImage.react"),{backgroundPosition:"center center",className:"_6j0r",height:"150px",imageURI:this.props.image,width:"100%"}):null};d.$2=function(){return this.props.title!=null?i.jsx("div",{className:"_6bxo",children:i.jsx(b("LineClamp.react"),{lines:2,children:this.props.title})}):null};d.$3=function(){return this.props.description!=null?i.jsx("div",{className:"_6bxp",children:i.jsx(b("LineClamp.react"),{lines:2,children:this.props.description})}):null};d.$4=function(){return this.props.source!=null?i.jsx("div",{className:"_6bxq",children:this.props.source}):null};return c}(i.Component);e.exports=a}),null);
__d("MPNFallbackAttachment.react",["cx","fbt","CssBackgroundImage.react","Link.react","LiveChatPluginLoggerUtil","MPNIdentity","MessagingPluginContext","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.$4=function(){var a=d.context.state.pageID,c=b("MPNIdentity").MPNIdentity.currentUserID(),e=b("MPNIdentity").MPNIdentity.currentUserState();b("LiveChatPluginLoggerUtil").logActionFromNewUI("in_thread_action",c,a,e===b("MPNIdentity").MPNIdentityState.FB?"logged_in_chat_tab":"guest_chat_tab",{action_type:"customer_chat_attachment_fallback_clicked",xma_type:d.props.style})},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.componentDidMount=function(){var a=this.context.state.pageID,c=b("MPNIdentity").MPNIdentity.currentUserID(),d=b("MPNIdentity").MPNIdentity.currentUserState();b("LiveChatPluginLoggerUtil").logActionFromNewUI("in_thread_action",c,a,d===b("MPNIdentity").MPNIdentityState.FB?"logged_in_chat_tab":"guest_chat_tab",{action_type:"customer_chat_attachment_fallback_impression",xma_type:this.props.style})};d.render=function(){var a=this.context.state.accessToken;if(a)return j.jsxs("div",{className:"_6bxn",children:[this.$1(),j.jsx("div",{className:"_6j2g",children:this.$2()})]});else return j.jsxs("div",{className:"_6bxn",children:[this.$1(),j.jsxs("div",{className:"_6j2g",children:[this.$2(),this.$3()]})]})};d.$1=function(){return this.props.image!=null?j.jsx(b("CssBackgroundImage.react"),{backgroundPosition:"center center",className:"_6j0r",height:"150px",imageURI:this.props.image,width:"100%"}):null};d.$2=function(){return this.props.title!=null?j.jsx("div",{className:"_6bxo",children:this.props.title}):null};d.$3=function(){return j.jsx("div",{className:"_6bxp",children:h._("\u5728 Messenger {=See the full message}",[h._param("=See the full message",j.jsx(b("Link.react"),{onClick:this.$4,href:"https://m.me/"+this.context.state.pageID,target:"_blank",children:h._("\u67e5\u770b\u5b8c\u6574\u8a0a\u606f")}))])})};return c}(j.PureComponent);e.exports=a;a.contextType=b("MessagingPluginContext")}),null);
__d("ChatPluginTemplateConverter",["URI","nullthrows"],(function(a,b,c,d,e,f){"use strict";f.convertLegacySchemaToGenericTemplate=h;f.convertLightspeedSchemaToGenericTemplate=i;f.convertSchemaToHScroll=a;f.convertLegacySchemaToMediaTemplate=c;f.convertLightspeedSchemaToMediaTemplate=d;var g;function h(a,b){a=b?(b=a)!=null?b.target:b:(b=a)!=null?(b=b.share)!=null?(b=b.target)!=null?(b=b.items)!=null?b[0]:b:b:b:b;return!a||!a.name?null:{title:a.name,subtitle:(b=a)!=null?(b=b.metalines)!=null?b.metaline_1:b:b,default_action:(b=a)!=null?(b=b.default_action)!=null?b.action_link:b:b,image_url:a.thumb_url?a.thumb_url:(b=a)!=null?(b=b.media_blob_attachments)!=null?(b=b[0])!=null?(b=b.image)!=null?b.uri:b:b:b:b,image_aspect_ratio:a.image_aspect_ratio,ctas:a.call_to_actions}}function i(a){var b;if(!a)return null;b=(b=a)!=null?b.messenger_generic_xma_template_extra_info:b;var c=[];for(var d=1;d<4;d++){var e,f="cta"+d;if(!b||!((e=b)!=null?e[f]:e))break;c.push(b[f])}return{title:a.title,subtitle:a.description,default_action:b==null?void 0:(e=b.default_cta)==null?void 0:e.action_url,image_url:(f=a.media)==null?void 0:f.image,image_aspect_ratio:null,ctas:c}}function a(a){a=(a=a)!=null?(a=a.share)!=null?a.subattachments:a:a;return!a||a.length===0?[]:a.map(function(a){var b;b=(b=a)!=null?(b=b.style_list)!=null?b[0]:b:b;return b=="messenger_generic_template"?i(a):h(a,!0)}).filter(function(a){return a})}function c(a){var c,d;d=(d=a)!=null?(d=d.share)!=null?(d=d.target)!=null?(d=d.items)!=null?d[0]:d:d:d:d;if(!d)return null;c=(c=d)!=null?(c=c.media_blob_attachments)!=null?(c=c[0])!=null?c.large_preview:c:c:c;if(c)return{image_url:c.uri,height:c.height,width:c.width,playable:!1,ctas:d.call_to_actions};c=(c=d)!=null?(c=c.media_blob_attachments)!=null?(c=c[0])!=null?c.playable_url:c:c:c;if(!c)return null;d=b("nullthrows")((d=d)!=null?(d=d.media_blob_attachments)!=null?d[0]:d:d);var e,f,g=null;d.__typename==="MessageVideo"?(e=d.original_dimensions.x,f=d.original_dimensions.y):(e=d.width,f=d.height,g=!0);return{image_url:null,height:f,width:e,playable:!0,playable_url:c,source_id:d.legacy_attachment_id?d.legacy_attachment_id:d.id,is_share:(f=g)!=null?f:!1,page_id:(e=a.metadata)==null?void 0:e.pageid,ctas:[]}}function d(a){var c;if(!((c=a.share)==null?void 0:c.media))return null;c=b("nullthrows")(a.share.media);a=(a=a)!=null?(a=a.share)!=null?a.messenger_generic_xma_template_extra_info:a:a;var d=[];for(var e=1;e<4;e++){var f,h="cta"+e;if(!a||!((f=a)!=null?f[h]:f))break;d.push(a[h])}if(c.playable&&c.source){f=new(g||(g=b("URI")))(c.source).getQueryData();return{image_url:null,height:(h=c.image_size)==null?void 0:h.height,width:(a=c.image_size)==null?void 0:a.width,playable:c.playable,playable_url:c.source,source_id:f.entity_id,is_share:!1,ctas:d}}if(c.image){return{image_url:c.image,height:(e=c.image_size)==null?void 0:e.height,width:(h=c.image_size)==null?void 0:h.width,playable:!1,ctas:d}}return null}}),null);
__d("MPNCallToAction.react",["cx","fbt","Link.react","LiveChatPluginLoggerUtil","MNCommerceCTAProcessor","MNCommercePostbackCTADataManager","MPNIdentity","MercuryIDs","MessagingPluginContext","PopupWindow","Tooltip.react","joinClasses","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react"),k="https://www.facebook.com/plugins/chat/transcript";a=function(a){babelHelpers.inheritsLoose(c,a);function c(c,d){var e;e=a.call(this,c,d)||this;e.$5=function(){e.$9("customer_chat_open_url_cta_clicked")};e.$1=b("MercuryIDs").getThreadIDFromUserID(e.context.state.pageID);e.$2=b("LiveChatPluginLoggerUtil").getAttributionTags();return e}var d=c.prototype;d.render=function(){var a,c=this,d=this.props,e=d.callToAction,f=d.messageID;d=(d=(d=e.action_type)!=null?d:e.action_open_type)!=null?d:e.type;a=(a=e.action_title)!=null?a:e.title;if(d==null||a==null)return null;var g=null;switch(d){case 2:case"xma_web_url":var h=(d=e.action_link)!=null?d:e.action_url;d=h!=null?h.includes(k):!1;d?g=this.$3(a,function(){c.$4(h)}):g=this.$3(a,this.$5,h);break;case 31:g=this.$3(a,function(){c.$4(e.action_link)});break;case 4:case"xma_postback":g=this.$3(a,function(){c.$6(e,f)});break;case 1:d=(d=e)!=null?(d=d.webview_metadata)!=null?d.messenger_extensions:d:d;if(d!=null){d=(d=e)!=null?(d=d.webview_metadata)!=null?d.fallback_url:d:d;g=this.$3(a,this.$5,d!=null?d:e.action_link)}else g=this.$7(a);break;case 5:case"xma_account_link":g=this.$3(a,function(){c.$8(e,f)});break;default:g=this.$7(a)}return j.jsx("div",{className:b("joinClasses")(this.props.className,"_6ir5"),children:j.jsx("div",{style:{width:(d=this.props.width)!=null?d:null},className:"_4bqf _6ir3",children:g})})};d.$3=function(a,c,d){return j.jsx(b("Link.react"),{className:"_6ir4",href:d,style:{color:this.context.state.threadCSSColor},onClick:c,target:"_blank",children:a})};d.$7=function(a){return j.jsx("div",{className:"_6ir4 _6ir6",children:j.jsx(b("Tooltip.react"),{tooltip:h._("\u82e5\u8981\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u8acb\u4f7f\u7528 Messenger \u61c9\u7528\u7a0b\u5f0f\u3002"),children:a})})};d.$8=function(a,c){var d;b("MNCommerceCTAProcessor").process((d=(d=a.id)!=null?d:a.target_id)!=null?d:"",c);this.$9("customer_chat_account_link_cta_clicked")};d.$4=function(a){b("PopupWindow").open(a,420,450),this.$9("customer_chat_open_dialog_cta_clicked")};d.$6=function(a,c){var d=b("MPNIdentity").MPNIdentity.currentUserState();switch(d){case b("MPNIdentity").MPNIdentityState.FB:b("MNCommercePostbackCTADataManager").sendAndConfirm((d=(d=a.id)!=null?d:a.target_id)!=null?d:"",(d=(d=a.action_title)!=null?d:a.title)!=null?d:"",this.$1,null,null,null,this.$2,c,null,"source:discovery:customer_chat_plugin");break;case b("MPNIdentity").MPNIdentityState.GUEST:d=this.context.state.messageStore;c=d.sendQueue;if(!c)return;c.enqueueAndSend((d=(d=a.action_title)!=null?d:a.title)!=null?d:"",c.makePlatformTokenForPostbackCTA((c=(d=a.id)!=null?d:a.target_id)!=null?c:""));break;default:return}this.$9("customer_chat_postback_clicked")};d.$9=function(a){var c=this.context.state.pageID;b("LiveChatPluginLoggerUtil").logActionFromNewUI("in_thread_action",b("MPNIdentity").MPNIdentity.currentUserID(),c,b("MPNIdentity").MPNIdentity.currentUserState()===b("MPNIdentity").MPNIdentityState.FB?"logged_in_chat_tab":"guest_chat_tab",{action_type:a})};return c}(j.PureComponent);e.exports=a;a.contextType=b("MessagingPluginContext")}),null);
__d("MPNButtonTemplate.react",["cx","MPNCallToAction.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a;a=(a=this.props.attachment)!=null?(a=a.share)!=null?(a=a.target)!=null?a.call_to_actions:a:a:a;var c=this.props.messageID;if(!a||a.length===0)return null;a=a.map(function(a,d){return i.jsx(b("MPNCallToAction.react"),{callToAction:a,className:d===0?"_6isd":"",messageID:c},a.id)});return i.jsx("div",{className:"_6b7s",children:a})};return c}(i.PureComponent);e.exports=a}),null);
__d("MPNGenericTemplate.react",["cx","CssBackgroundImage.react","LineClamp.react","Link.react","MPNCallToAction.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return!this.props.template?null:i.jsxs("div",{className:"_6j2i",children:[this.$1(),i.jsxs("div",{className:"_6j2g",children:[this.$2(),this.$3()]}),this.$4()]})};d.$1=function(){var a,c,d;a=(a=this.props.template)==null?void 0:a.image_url;c=(c=this.props.template)==null?void 0:c.default_action;d=this.props.imageAspectRatio?this.props.imageAspectRatio:(d=this.props.template)==null?void 0:d.image_aspect_ratio;d=a||this.props.hasImage?i.jsx(b("CssBackgroundImage.react"),{backgroundPosition:"center center",className:"_6j0s",height:d===1?"260px":"150px",imageURI:a,width:"100%"}):null;if(c&&a)return i.jsx(b("Link.react"),{href:c,target:"_blank",children:d});else return d};d.$2=function(){var a;a=(a=this.props.template)==null?void 0:a.title;return a?i.jsx(b("LineClamp.react"),{className:"_6j0t",lines:3,children:a}):null};d.$3=function(){var a;a=(a=this.props.template)==null?void 0:a.subtitle;return a?i.jsx("div",{className:"_6j0u",children:a}):null};d.$4=function(){var a;a=(a=this.props.template)==null?void 0:a.ctas;var c=this.props.messageID;if(!a||a.length===0)return null;var d=a.map(function(a,d){return i.jsx(b("MPNCallToAction.react"),{callToAction:a,messageID:c},d)});if(this.props.maxNumCTAs&&this.props.maxNumCTAs>a.length){var e=[];for(var f=0;f<this.props.maxNumCTAs-a.length;f++)e.push(i.jsx("div",{className:"_6j0z _6ir3 _6ir4",children:"\xa0"},f));d=e.concat(d)}return d};return c}(i.PureComponent);e.exports=a}),null);
__d("MPNHScrollTemplate.react",["cx","AdsArrowedCarouselEnhanced.react","MPNGenericTemplate.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return i.jsx(b("AdsArrowedCarouselEnhanced.react"),{isLeftArrowOverlappingContent:!1,children:this.$1()})};d.$1=function(){var a=this.props.messageID,c=!1,d=0,e=1.91;this.props.templates.forEach(function(a){a.ctas&&a.ctas.length>d&&(d=a.ctas.length),a.image_url!=null&&a.image_url.length>0&&(c=!0),a.image_aspect_ratio===1&&(e=1)});return this.props.templates.map(function(f,g){return i.jsx("div",{className:"_6j2h",children:i.jsx(b("MPNGenericTemplate.react"),{template:f,messageID:a,hasImage:c,imageAspectRatio:e,maxNumCTAs:d})},g)})};return c}(i.Component);e.exports=a}),null);
__d("XMNLiveChatVideoAttachmentController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/plugins/live_chat/video/",{video_id:{type:"String",required:!0},video_container_id:{type:"String",required:!0},width:{type:"Int",required:!0},height:{type:"Int",required:!0},start_muted:{type:"Bool",defaultValue:!1},no_fullscreen:{type:"Bool",defaultValue:!1},load_player_controller:{type:"Bool",defaultValue:!1},hide_controls_on_finish:{type:"Bool",defaultValue:!1},hide_url_menu_option:{type:"Bool",defaultValue:!1},is_share:{type:"Bool",defaultValue:!1},render_play_button:{type:"Bool",defaultValue:!1},start_timestamp:{type:"Int",defaultValue:0},native_thumbnail:{type:"Bool",defaultValue:!1},access_token:{type:"String"}})}),null);
__d("MPNVideoPlayer.react",["cx","ActorURI","AsyncRequest","BackgroundImage.react","Event","FullScreen","MessagingPluginContext","MessengerSpinner.react","ShimButton.react","SpotlightMercurySharedMediaViewer.react","SubscriptionsHandler","Vector","VideoPlayerReasonTransitionHelper","XMNLiveChatVideoAttachmentController","cssURL","getFullScreenElement","guid","joinClasses","prop-types","react","setImmediate"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react"),j="_ox1",k="_27db";a=function(a){babelHelpers.inheritsLoose(c,a);function c(c){var d,e;e=a.call(this,c)||this;e.$2=!0;e.$3=[];e.$4=-1;e.$5=!1;e.$6=!1;e.state={playerAPI:null,forcePause:!!((d=e.props.videoData)==null?void 0:d.disableAutoplay)};e.$10=function(a){if(e.isVideoControlClicked(a)){a.preventDefault();a.stopPropagation();return}if(!e.isVideoClicked(a))return;a.preventDefault();e.props.isOnStage?(a.stopPropagation(),e.isState("playing")?e.pause("user_initiated"):e.play("user_initiated")):(e.pause("user_initiated"),e.props.onClick&&e.props.onClick())};e.$11=function(a){if(!e.isRightClick(a))return;a.stopPropagation();a.preventDefault();b("setImmediate")(function(){e.props.onSelect&&e.props.onSelect()})};e.$8=function(){if(!e.$2||e.state.forcePause)return;e.$6&&(e.play(new(b("VideoPlayerReasonTransitionHelper"))("page_visibility_initiated")),e.$6=!1)};e.$7=function(){if(!e.$2||e.state.forcePause||!(e.state.playerAPI&&e.state.playerAPI.isMuted()))return;e.$6=!!e.state.playerAPI&&e.state.playerAPI.isState("playing");e.pause()};e.$1=b("guid")();e.$2=!((d=c.videoData)==null?void 0:d.disableAutoplay);e.props.isInThread&&(e.listeners=new(b("SubscriptionsHandler"))(),e.listeners.addSubscriptions(b("Event").listen(window,"blur",e.$7),b("Event").listen(window,"focus",e.$8)));return e}var d=c.prototype;d.shouldComponentUpdate=function(a){var c=document.getElementById(this.$1.toString()),d=b("FullScreen").isFullScreen();if(c!=null&&d&&c.children[0].children[0]===b("getFullScreenElement")())return!1;d=!!(a.stageDimensions&&a.stageDimensions!==this.props.stageDimensions);d&&(this.$4=this.getCurrentTimePosition(),this.$5=!this.isState("playing"));return!this.props.videoData||a.videoData.id!==this.props.videoData.id||d};d.UNSAFE_componentWillReceiveProps=function(a){if(!this.$2)return;this.props.isInThread&&a.isVisible!==this.props.isVisible&&(a.isVisible&&!this.state.forcePause?this.play(new(b("VideoPlayerReasonTransitionHelper"))("video_visibility_initiated")):this.pause())};d.componentDidMount=function(){this.props.videoData&&this.$9()};d.componentDidUpdate=function(){this.$3.forEach(function(a){return a.abandon()}),this.$3=[],this.props.videoData&&this.$9()};d.componentWillUnmount=function(){this.pause("unloaded"),this.seek(0),this.$3.forEach(function(a){return a.abandon()}),this.listeners&&this.listeners.release(),this.state.playerAPI&&this.state.playerAPI.detachRootNode(),this.state.playerAPI&&this.state.playerAPI.destroy&&this.state.playerAPI.destroy()};d.isVideoLoaded=function(){var a=!!this.state.playerAPI;!a;return this.isState("fallback")?!1:a};d.isVideoClicked=function(a){return a.target instanceof HTMLElement?a.target.classList.contains(j):!1};d.isVideoControlClicked=function(a){var b=document.getElementsByClassName(k);for(var b=b,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;var f=a.target;if(e.contains(f))return!0}return!1};d.isRightClick=function(a){a=a||window.event;return a.button===2};d.play=function(a){if(!this.isVideoLoaded())return;this.state.playerAPI&&this.state.playerAPI.play(a)};d.pause=function(a){if(!this.isVideoLoaded())return;this.state.playerAPI&&this.state.playerAPI.pause(a)};d.seek=function(a){if(!this.isVideoLoaded())return;this.state.playerAPI&&this.state.playerAPI.seek(a)};d.getCurrentTimePosition=function(){return this.isVideoLoaded()&&this.state.playerAPI?this.state.playerAPI.getCurrentTimePosition():-1};d.render=function(){var a=this.props.videoData,c=i.jsx("div",{ref:"placeholder",children:i.jsx(b("MessengerSpinner.react"),{color:"blue",size:b("MessengerSpinner.react").large_size})}),d={};if(a&&a.url){var e=a.original_dimensions;d.backgroundImage=b("cssURL")(a.url);c=i.jsx("div",{ref:"placeholder",children:i.jsx(b("BackgroundImage.react"),{className:this.props.className,width:e.x,height:e.y,loadingIndicatorStyle:"large",backgroundSize:"cover",ref:"placeholder",style:d,src:a.url})})}return i.jsx(b("ShimButton.react"),{className:b("joinClasses")(this.props.className,"_4-od"),id:this.$1,onClick:this.$10,onMouseDown:this.$11,style:d,children:c})};d.$9=function(){var a=this,c=this.props.videoData,d=this.context.state.accessToken;if(c){var e=c.original_dimensions;this.props.stageDimensions&&(e=b("SpotlightMercurySharedMediaViewer.react").getImageDimensionsForStage(new(b("Vector"))(c.original_dimensions.x,c.original_dimensions.y),this.props.stageDimensions));e=b("XMNLiveChatVideoAttachmentController").getURIBuilder().setString("video_id",c.legacy_attachment_id).setString("video_container_id",this.$1).setInt("width",e.x).setInt("height",e.y).setInt("start_timestamp",this.$4>0?Math.round(this.$4):0).setBool("start_muted",c.start_muted).setBool("no_fullscreen",c.no_fullscreen).setBool("load_player_controller",!0).setBool("hide_controls_on_finish",c.hide_controls_on_finish).setBool("native_thumbnail",c.disableAutoplay).setBool("hide_url_menu_option",Boolean(c.hide_url_menu_option)).setBool("is_share",c.is_share).setBool("render_play_button",this.props.isInThread).setString("access_token",d).getURI();this.props.pageId&&(e=b("ActorURI").create(e,this.props.pageId));var f=new(b("AsyncRequest"))();this.$3.push(f);f.setMethod("GET").setStatusElement(this.refs.placeholder).setURI(e).setRelativeTo(this).setReadOnly(!0).setHandler(function(b){a.$3=a.$3.filter(function(a){return a!==f})}).send()}};d.$12=function(){this.props.isVisible&&this.isState("finished")?(this.seek(0),this.play("loop_initiated")):this.props.isVisible&&this.isState("paused")&&!this.$6?this.setState({forcePause:!0}):this.isState("playing")&&this.setState({forcePause:!1})};d.onVideoLoaded=function(){var a=this;if(!this.$2)return;this.state.playerAPI&&this.state.playerAPI.addListener("stateChange",function(){return a.$12()});this.props.isVisible&&!this.$5&&!this.state.forcePause?this.play("autoplay_initiated"):this.pause();this.$4=-1;this.$5=!1};d.isState=function(a){return!!(this.state.playerAPI&&this.state.playerAPI.isState(a))};return c}(i.Component);e.exports=a;a.contextType=b("MessagingPluginContext");a.propTypes={pageId:b("prop-types").string,className:b("prop-types").string,isInThread:b("prop-types").bool,isVisible:b("prop-types").bool,isOnStage:b("prop-types").bool,stageDimensions:b("prop-types").instanceOf(b("Vector")),videoData:b("prop-types").object,onClick:b("prop-types").func,onSelect:b("prop-types").func};a.invokeVideoLoaded=function(a,b,c){a.$2=c,b.setAllowCrossPageTransition(!0),b.isState("loading")?a.stateChangeListener=b.addListener("stateChange",function(){if(!b.isState("loading")){if(a.state&&a.state.playerAPI)return;a.setState({playerAPI:b},a.onVideoLoaded);a.stateChangeListener&&a.stateChangeListener.remove()}}):a.setState({playerAPI:b},a.onVideoLoaded)}}),null);
__d("MPNMediaTemplate.react",["cx","Image.react","MPNCallToAction.react","MPNVideoPlayer.react","MWChatVideoPlayer.react","MessengerSpinner.react","VideoAutoplayManagerX.react","gkx","nullthrows","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react"),j=360,k=290,l=100;a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){if(!this.props.template)return null;var a=b("nullthrows")(this.props.template);return i.jsxs("div",{className:"_3cn0",children:[this.$1(a),this.$2(a)]})};d.$1=function(a){if(a.playable){if(!a.playable_url)return null;var c=this.$3(a);return this.$4(a,c)}if(!a.image_url)return null;c=this.$5({height:a.height,width:a.width});return i.jsx(b("Image.react"),{className:"_2k7y",height:c.y,width:c.x,src:a.image_url})};d.$3=function(a){return{legacy_attachment_id:a.source_id,original_dimensions:this.$5({height:a.height,width:a.width}),start_muted:!0,no_fullscreen:!0,hide_controls_on_finish:!0,url:a.playable_url,is_share:a.is_share}};d.$4=function(a,c){if(c===null||c===void 0)return null;a=b("gkx")("1954636")?i.jsx(b("VideoAutoplayManagerX.react"),{children:i.jsx(b("MWChatVideoPlayer.react"),{controls:"mwchat",fbid:c.fbid,originalHeight:c.original_dimensions.y,originalWidth:c.original_dimensions.x,sdSrc:c.url})}):i.jsx(b("MPNVideoPlayer.react"),{pageId:a.page_id,videoData:c,isInThread:!0,isVisible:!0});return i.jsx(i.Suspense,{fallback:i.jsx("div",{style:{width:c.original_dimensions.x,height:c.original_dimensions.y},children:i.jsx("div",{className:"spinner",children:i.jsx(b("MessengerSpinner.react"),{color:"blue",size:b("MessengerSpinner.react").medium_size})})}),children:a})};d.$5=function(a){var b=a.width;a=a.height;var c=1;c=Math.min(c,Math.min(k/b,j/a));c=Math.max(c,l/b);b=Math.round(b*c);a=Math.round(a*c);return{x:b,y:a}};d.$2=function(a){if(!a.ctas||a.ctas.length===0)return null;var c=this.props.messageID,d=this.$5({height:a.height,width:a.width});a=a.ctas.map(function(a,e){return i.jsx(b("MPNCallToAction.react"),{width:d.x,callToAction:a,className:e===0?"_6isd":"",messageID:c},a.id)});return a};return c}(i.PureComponent);e.exports=a}),null);
__d("MPNTemplateRenderer.react",["ChatPluginTemplateConverter","MPNButtonTemplate.react","MPNFallbackAttachment.react","MPNGenericTemplate.react","MPNHScrollTemplate.react","MPNMediaTemplate.react","react"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a,c;c=(c=this.props.attachment)!=null?(c=c.share)!=null?(c=c.style_list)!=null?c[0]:c:c:c;var d=this.props.messageID;switch(c){case"h_scroll":return h.jsx(b("MPNHScrollTemplate.react"),{templates:b("ChatPluginTemplateConverter").convertSchemaToHScroll(this.props.attachment),messageID:d});case"business_message_items":a=(a=this.props.attachment)!=null?(a=a.share)!=null?(a=a.target)!=null?a.call_to_actions:a:a:a;if(a&&a.length>0)return h.jsx(b("MPNButtonTemplate.react"),{attachment:this.props.attachment,messageID:d});else return h.jsx(b("MPNGenericTemplate.react"),{template:b("ChatPluginTemplateConverter").convertLegacySchemaToGenericTemplate(this.props.attachment,!1),messageID:d});case"messenger_platform_media_attachment":return h.jsx(b("MPNMediaTemplate.react"),{template:b("ChatPluginTemplateConverter").convertLegacySchemaToMediaTemplate(this.props.attachment),messageID:d});case"messenger_generic_template":return((a=this.props.attachment.share)==null?void 0:(a=a.media)==null?void 0:a.playable)?h.jsx(b("MPNMediaTemplate.react"),{template:b("ChatPluginTemplateConverter").convertLightspeedSchemaToMediaTemplate(this.props.attachment),messageID:d}):h.jsx(b("MPNGenericTemplate.react"),{template:b("ChatPluginTemplateConverter").convertLightspeedSchemaToGenericTemplate(this.props.attachment.share),messageID:d});default:d=(a=this.props.attachment)!=null?(a=a.share)!=null?(a=a.media)!=null?a.image:a:a:a;a=(a=this.props.attachment)!=null?(a=a.share)!=null?a.title:a:a;return h.jsx(b("MPNFallbackAttachment.react"),{style:c,image:d,title:a})}};return c}(h.PureComponent);e.exports=a}),null);
__d("MPNAttachmentRenderer.react",["cx","Image.react","JSResource","LiveChatPluginFileAttachment.react","LiveChatPluginLinkShareAttachment.react","MPNFallbackAttachment.react","MPNTemplateRenderer.react","MWChatVideoPlayer.react","MercuryAttachment","MessagingPluginContext","MessengerSpinner.react","ShimButton.react","Sticker.react","StickerConstants","URI","VideoAutoplayManagerX.react","XStickerAssetController","gkx","guid","isLinkshimURI","lazyLoadComponent","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||b("react"),k=b("lazyLoadComponent")(b("JSResource")("MPNVideoPlayer.react").__setRef("MPNAttachmentRenderer.react")),l=360,m=290;a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a=this;return b("MercuryAttachment").get(this.props.message).filter(function(a){return a===Object(a)}).map(function(c){var d,e=null;switch(c.attach_type){case"animated_image":case"photo":e=a.$1(c);break;case"sticker":e=a.$2(c);break;case"video":e=a.$3(c);break;case"share":e=a.$4(c);break;case"file":return a.$5(c);default:d=(d=c)!=null?(d=d.media)!=null?d.image:d:d;e=j.jsx(b("MPNFallbackAttachment.react"),{style:c.attach_type,image:d,title:c.title});break}return j.jsx("div",{className:a.$6(c)?"_2k7x":"",children:e},a.$7(c))})};d.$1=function(a){return j.jsx(b("Image.react"),{className:"_2k7y",onClick:this.props.onMessageClick,src:a.large_preview_url||a.preview_url})};d.$2=function(a){a=a.metadata;return!a?null:j.jsx(b("ShimButton.react"),{onClick:this.props.onMessageClick,children:j.jsx(b("Sticker.react"),{accessibilityLabel:a.accessibilityLabel,animationTrigger:"load_and_hover",customColor:this.context.state.threadCSSColor,frameCount:a.frameCount||1,frameRate:a.frameRate||b("StickerConstants").DEFAULT_FRAME_RATE,framesPerCol:a.framesPerCol||1,framesPerRow:a.framesPerRow||1,paddedSpriteURI:a.paddedSpriteURI,sourceHeight:a.height,sourceURI:b("XStickerAssetController").getURIBuilder().setInt("sticker_id",a.stickerID).getURI().toString(),sourceWidth:a.width,stickerID:a.stickerID.toString(),spriteURI:a.spriteURI})})};d.$3=function(a){var c=this.$8(a);if(c===null||c===void 0)return null;a=b("gkx")("1954636")?j.jsx(b("VideoAutoplayManagerX.react"),{children:j.jsx(b("MWChatVideoPlayer.react"),{controls:"mwchat",fbid:c.fbid,originalHeight:c.original_dimensions.y,originalWidth:c.original_dimensions.x,sdSrc:c.url})}):j.jsx(k,{pageId:(a=a.metadata)==null?void 0:a.pageid,videoData:c,isInThread:!0,isVisible:!0,onClick:this.props.onMessageClick});return j.jsx(j.Suspense,{fallback:j.jsx("div",{style:{width:c.original_dimensions.x,height:c.original_dimensions.y},children:j.jsx("div",{className:"spinner",children:j.jsx(b("MessengerSpinner.react"),{color:"blue",size:b("MessengerSpinner.react").medium_size})})}),children:a})};d.$4=function(a){var c,d,e,f=this.$9();e=(e=a)!=null?(e=e.share)!=null?e.uri:e:e;c=(c=this.props.message)==null?void 0:c.message_id;d=a==null?void 0:(d=a.share)==null?void 0:d.style_list;var g="fallback";d!=null&&d.length>0&&(g=d[0]);d=f!=null||g=="business_message_items"||g=="messenger_generic_template"||g=="h_scroll";if(d)return j.jsx(b("MPNTemplateRenderer.react"),{attachment:a,messageID:c});else if(e&&b("isLinkshimURI")(new(i||(i=b("URI")))(e))){var h;d=(f=a)!=null?(f=f.share)!=null?f.description:f:f;f=(c=a)!=null?(c=c.share)!=null?(c=c.media)!=null?c.image:c:c:c;c=(c=a)!=null?(c=c.share)!=null?c.source:c:c;h=(h=a)!=null?(h=h.share)!=null?h.title:h:h;return j.jsx(b("LiveChatPluginLinkShareAttachment.react"),{description:d,image:f,source:c,title:h,uri:e})}else{f=(d=a)!=null?(d=d.share)!=null?(d=d.media)!=null?d.image:d:d:d;h=(c=a)!=null?(c=c.share)!=null?c.title:c:c;return j.jsx(b("MPNFallbackAttachment.react"),{style:g,image:f,title:h})}};d.$5=function(a){return j.jsx(b("ShimButton.react"),{className:"_2k7x",onClick:this.props.onMessageClick,style:{border:"none"},children:j.jsx("div",{className:"_46jp",style:{backgroundColor:this.props.backgroundColor},children:j.jsx(b("LiveChatPluginFileAttachment.react"),{attachment:a,isFromViewer:this.props.isFromViewer},"file:"+a.url)})},this.$7(a))};d.$7=function(a){if(a.deduplication_key)return a.deduplication_key;if(a.metadata&&a.metadata.fbid)return a.metadata.fbid;return a.upload_id?a.upload_id:b("guid")()};d.$8=function(a){var b,c;if(!a.metadata)return null;c=((c=a)!=null?(c=c.metadata)!=null?(c=c.dimensions)!=null?c.width:c:c:c)||m;b=((b=a)!=null?(b=b.metadata)!=null?(b=b.dimensions)!=null?b.height:b:b:b)||l;c=c/b;b={x:c>=1?m:Math.round(l*c),y:c>=1?Math.round(m/c):l};return{legacy_attachment_id:a.metadata.fbid,original_dimensions:b,start_muted:!0,no_fullscreen:!0,hide_controls_on_finish:!0,url:a.url}};d.$9=function(){try{var a=this.props.message.platform_xmd;if(a){a=JSON.parse(a);if(a)return a}}catch(a){}return null};d.$6=function(a){if(a.attach_type==="sticker")return!1;if(a.attach_type==="share"){var b=this.$9();a=(a=a)!=null?(a=a.share)!=null?(a=a.style_list)!=null?a[0]:a:a:a;if(b&&a==="h_scroll")return!1}return!0};return c}(j.PureComponent);e.exports=a;a.contextType=b("MessagingPluginContext")}),null);
__d("MPNQuickReplyContainer.react",["cx","react"],(function(a,b,c,d,e,f,g){"use strict";e.exports=a;var h,i=h||b("react");function a(a){var b=a.layout;a=a.children;b=b==="horizontal";return i.jsx("div",{className:(b?"_9k7q":"")+(b?"":" _9k7r"),children:a})}}),null);
__d("MPNQuickReplyPill.react",["cx","ShimButton.react","Tooltip.react","react"],(function(a,b,c,d,e,f,g){"use strict";e.exports=a;var h,i=h||b("react");function a(a){var c=a.children,d=a.onClick,e=a.disabled;a=a.tooltip;e=i.jsx(b("ShimButton.react"),{"data-testid":void 0,className:"_9k7s"+(e?" _9k7t":""),onClick:d,children:c});return a!==void 0?i.jsx(b("Tooltip.react"),{tooltip:a,children:e}):e}}),null);
__d("MPNIcebreakers.react",["LiveChatPluginLoggerUtil","MNCommercePostbackCTADataManager","MPNIdentity","MPNQuickReplyContainer.react","MPNQuickReplyPill.react","MercuryIDs","MercuryMessageActions","MercuryMessageObject","MessagingPluginContext","gkx","react"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g,h=g||b("react");function a(a){var c=h.useContext(b("MessagingPluginContext")).state,d=c.icebreakers,e=c.icebreakerCtas,f=c.pageID,g=c.messageStore,i=b("MercuryIDs").getThreadIDFromUserID(f),j=b("LiveChatPluginLoggerUtil").getAttributionTags();h.useEffect(function(){d!=null&&d.length>0&&(b("gkx")("1877511")?b("LiveChatPluginLoggerUtil").logImpressionUsingFalco(f,"icebreakers",null,null,null,null,b("MPNIdentity").MPNIdentity.currentUserID()):b("LiveChatPluginLoggerUtil").logImpressionFromNewUI("tab_impression",f,"icebreakers",null,null,null,null,null,b("MPNIdentity").MPNIdentity.currentUserID()))},[f,d]);if(!d)return null;var k=function(a){var c=b("MPNIdentity").MPNIdentity.currentUserID();if(c==null)return;c=b("MPNIdentity").MPNIdentity.currentUserState();if(c===b("MPNIdentity").MPNIdentityState.GUEST){if(!g||!g.sendQueue)return;var d=g.sendQueue;if(!d)return;d.enqueueAndSend(a.title,d.makePlatformTokenForPostbackCTA(a.id))}else c===b("MPNIdentity").MPNIdentityState.FB&&b("MNCommercePostbackCTADataManager").sendAndConfirm(a.id,a.title,i,null,null,null,j,null,null,"source:discovery:customer_chat_plugin");m()},l=function(c){var d=b("MPNIdentity").MPNIdentity.currentUserID();if(d==null)return;var e=b("MPNIdentity").MPNIdentity.currentUserState();if(e===b("MPNIdentity").MPNIdentityState.GUEST){if(!g||!g.sendQueue)return;var f=g.sendQueue;if(!f)return;f.enqueueAndSend(c)}else if(e===b("MPNIdentity").MPNIdentityState.FB){f=new(b("MercuryMessageObject"))(d);e=b("MercuryMessageActions").getForFBID(d);e.send(f.constructUserGeneratedMessageObject(c,"source:discovery:customer_chat_plugin",a.threadID,null,null,b("LiveChatPluginLoggerUtil").getAttributionTags()))}m()},m=function(){var a=b("MPNIdentity").MPNIdentity.currentUserID();if(a==null)return;var c=b("MPNIdentity").MPNIdentity.currentUserState();c===b("MPNIdentity").MPNIdentityState.GUEST?b("gkx")("1874704")?b("LiveChatPluginLoggerUtil").logActionUsingFalco(a,f,"guest_chat_tab","message_send",null,null,null,"true"):b("LiveChatPluginLoggerUtil").logActionFromNewUI("message_send",a,f,"guest_chat_tab",{isIcebreaker:"true"}):b("gkx")("1874704")?b("LiveChatPluginLoggerUtil").logActionUsingFalco(a,f,"logged_in_chat_tab","message_send",null,null,null,"true"):b("LiveChatPluginLoggerUtil").logActionFromNewUI("message_send",a,f,"logged_in_chat_tab",{isIcebreaker:"true"})};e!=null&&e.length>0?c=e.map(function(a,c){return h.jsx(b("MPNQuickReplyPill.react"),{onClick:function(){return k(a)},children:a.title},c)}):c=d.map(function(a,c){return h.jsx(b("MPNQuickReplyPill.react"),{onClick:function(){return l(a.message)},children:a.message},a.messageKey+c)});return h.jsx(b("MPNQuickReplyContainer.react"),{layout:"vertical",children:c})}}),null);
__d("MPNLogMessage.react",["cx","Link.react","LinkCTAXMATAsyncLink.react","MessengerTextWithEntities.react","react"],(function(a,b,c,d,e,f,g){"use strict";e.exports=a;var h,i=h||b("react");function a(a){var c;c=(c=a.message)!=null?(c=c.log_message_data)!=null?c.message_type:c:c;var d=null;switch(c){case"link_cta":if(a.message.log_message_data!=null&&a.message.log_message_data.untypedData!==null){c=a.message.log_message_data.untypedData;var e=c.primary_text?c.primary_text:c.link_cta_xmat_primary_text,f=c.primary_text?c.cta_text:c.link_cta_xmat_cta_text;if(c.www_is_async_url){var g=c.async_url;d=i.jsxs("div",{children:[e," ",i.jsx(b("LinkCTAXMATAsyncLink.react"),{text:f,uri:g})]})}else{g=c.primary_text?c.cta_url:c.link_cta_xmat_cta_url;d=i.jsxs("div",{children:[e," ",i.jsx(b("Link.react"),{href:g,children:f})]})}}else d=null;break;default:d=i.jsx(b("MessengerTextWithEntities.react"),{renderEmoji:!0,renderEmoticons:!0,text:a.message.log_message_body})}return i.jsx("div",{className:"logMessage",children:d})}}),null);
__d("MPNMessage.react",["cssVar","cx","fbt","Arbiter","EmojiOnlyMessage.react","Image.react","Link.react","LiveChatPluginConstants","LiveChatPluginLoggerUtil","MPNAttachmentRenderer.react","MPNIdentity","MercuryMessageDeliveryState","MercuryTimestamp","MessagingPluginContext","MessengerDateBreak.re","MessengerHotLikeSVGReact.re","MessengerMessage.bs","MessengerSupportedEmojiUtils","MessengerTextWithEntities.react","ReactDOM","ShimButton.react","Text.react","URI","UnicodeUtils","getURLRanges","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l,m=b("MessengerDateBreak.re").make,n=b("MessengerHotLikeSVGReact.re").make,o=j||(j=b("react"));a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.state={emojis:null,showTimestamp:!1},d.$1=!1,d.$15=function(){var a=d.context.state,c=a.guestID;a=a.pageID;if(d.props.message.message_id=="welcome_message")return;d.setState(function(a){a=!a.showTimestamp;d.props.showTimestampHandler(a&&d.props.isLastMessageInGroup&&!d.props.isFromViewer);a&&b("Arbiter").inform(b("LiveChatPluginConstants").CLOSE_TIMESTAMPS);return{showTimestamp:a}});b("LiveChatPluginLoggerUtil").logActionFromNewUI("in_thread_action",c,a,b("MPNIdentity").MPNIdentity.currentUserState()===b("MPNIdentity").MPNIdentityState.FB?"logged_in_chat_tab":"guest_chat_tab",{action_type:"customer_chat_message_bubble_clicked"})},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.componentDidMount=function(){var a=this;if(this.props.message.body){var c=b("MessengerSupportedEmojiUtils").getEmojiOnlyContents(this.props.message.body);this.setState({emojis:c})}this.$2=b("Arbiter").subscribe(b("LiveChatPluginConstants").CLOSE_TIMESTAMPS,function(b){a.state.showTimestamp&&(a.setState({showTimestamp:!1}),a.props.isLastMessageInGroup&&!a.props.isFromViewer&&a.props.showTimestampHandler(!1))})};d.componentDidUpdate=function(){if(this.state.showTimestamp){var a=b("ReactDOM").findDOMNode(this);a instanceof HTMLElement&&this.props.scrollIntoView(a,this.props.dateBreakPreceeds)}};d.componentWillUnmount=function(){b("Arbiter").unsubscribe(this.$2)};d.render=function(){var a=this.props,c=a.isFromViewer;a=a.message;if(a.is_filtered_content)return null;var d=b("MessengerMessage.bs").getDeliveryState(this.props.message,this.props.deliveryTimestamp),e=this.$3(d),f="transparent";!this.state.emojis&&c?f=this.context.state.threadCSSColor:!this.state.emojis&&!c&&(f="#f1f0f0");var g=this.$4();return o.jsxs("div",{className:"_21c3",children:[this.$5(),o.jsxs("div",{className:"clearfix _2a0-",children:[this.$6(a,c,f),this.$7(a,c,f),this.$8(g),this.$9(d,e),this.$10(d,e)]}),this.$11(d,e,g)]})};d.$12=function(a){var c=(k||(k=b("UnicodeUtils"))).strlen(a),d=b("getURLRanges")(a).filter(function(a){return a!==void 0&&a!==null});d=d.filter(function(a){return a.offset>=0&&a.offset+a.length<=c}).map(function(a){return babelHelpers["extends"]({},a,{offset:a.offset})});return o.jsx(b("MessengerTextWithEntities.react"),{interpolator:this.$13,isSupportedEmoji:this.$14,ranges:d,renderEmoji:!0,renderEmoticons:!0,text:a})};d.$13=function(a,c){if(c.entity&&c.entity.url&&(l||(l=b("URI"))).isValidURI(c.entity.url)){var d=new(l||(l=b("URI")))(c.entity.url.replace(/#+$/,""));d=d.toString();return o.jsx(b("Link.react"),{href:{url:d,shimhash:c.entity.shimhash},s:c.entity.s,target:"_blank",children:a})}return a};d.$14=function(a){return b("MessengerSupportedEmojiUtils").isSupportedEmojiKey(a)};d.$5=function(){return!this.state.showTimestamp||this.props.dateBreakPreceeds?null:o.jsx(m,{className:"datebreak",date:new Date(this.props.message.timestamp)})};d.$6=function(a,c,d){var e=null;this.state.emojis&&this.state.emojis.length>0?e=o.jsx(b("EmojiOnlyMessage.react"),{contents:this.state.emojis}):a.body?e=this.$12(a.body):e=null;return e?o.jsx(b("ShimButton.react"),{className:"_4xko"+(this.state.emojis?" _gb1":"")+(c?"":" _4xkr")+(c?" _4xks":""),onClick:this.$15,style:{backgroundColor:d},tabIndex:"0",children:e},"t:"+a.message_id):null};d.$7=function(a,c,d){var e=null;if(a.has_attachment||a.attachments.length>0){d=a.is_like_preview?o.jsx("div",{className:"_8gn6 _8gn7",children:o.jsx(n,{color:d})}):o.jsx(b("MPNAttachmentRenderer.react"),{backgroundColor:d,isFromViewer:c,message:a,onMessageClick:this.$15});d&&(e=o.jsx("div",{className:"_4xko _2k7w"+(c?"":" _4xkr")+(c?" _4xks":""),children:d},"a:"+a.message_id))}return e};d.$4=function(){var a=this.props,b=a.message,c=a.isFromViewer,d=a.isLastMessageInGroup,e=a.lastReadTimestamp,f=a.showSentAndSeenHead;a=a.nextMessageTimestamp;if(!f)return!1;if(c&&!(e===Infinity&&d&&a===Infinity||e===b.timestamp||e>b.timestamp&&e<a))return!1;else if(!c&&e!==b.timestamp)return!1;return!0};d.$8=function(a){var c=this.props,d=c.message;c=c.readReceipt;var e=this.context.state,f=e.pageName;e=e.pageProfilePictureUri;if(b("MessengerMessage.bs").isSending(d)||b("MessengerMessage.bs").hasError(d)||!e||!a||c==null)return null;d=c.action/1e3;a=Object.keys(c).length?i._("{full name}\u5df2\u5728{seen time}\u770b\u904e",[i._param("full name",f),i._param("seen time",b("MercuryTimestamp").getPreciseTimestamp(d))]):i._("{full name}\u5df2\u770b\u904e",[i._param("full name",f)]);return o.jsx("span",{className:"_21c4",children:o.jsx(b("Image.react"),{alt:a,className:"_21c5",src:e,title:a})})};d.$3=function(a){switch(a){case b("MercuryMessageDeliveryState").SENDING:return i._("\u50b3\u9001\u4e2d");case b("MercuryMessageDeliveryState").SENT:return i._("\u5df2\u50b3\u9001");case b("MercuryMessageDeliveryState").DELIVERED:return i._("\u5df2\u50b3\u9001");case b("MercuryMessageDeliveryState").ERROR:return i._("\u932f\u8aa4");default:return null}};d.$10=function(a,c){if(!this.props.isFromViewer||!this.props.showDeliveryState||a===b("MercuryMessageDeliveryState").UNKNOWN||this.$1)return null;var d={};this.context.state.threadCSSColor&&(a===b("MercuryMessageDeliveryState").SENT||a===b("MercuryMessageDeliveryState").SENDING||a===b("MercuryMessageDeliveryState").DELIVERED)&&(d.color=this.context.state.threadCSSColor);return o.jsx("span",{className:"_21c6"+(a===b("MercuryMessageDeliveryState").SENDING?" _4f-a":"")+(a===b("MercuryMessageDeliveryState").SENT?" _4f-b":"")+(a===b("MercuryMessageDeliveryState").DELIVERED?" _21c8":""),style:d,title:c,children:o.jsx("i",{"aria-label":c,"aria-roledescription":i._("\u72c0\u614b\u5716\u793a"),className:a!==b("MercuryMessageDeliveryState").SENDING?"_21c7":"",role:"img"})})};d.$9=function(a,c){if(!this.props.isFromViewer)return null;a===b("MercuryMessageDeliveryState").ERROR||a===b("MercuryMessageDeliveryState").SENDING&&this.props.connectionState!==b("LiveChatPluginConstants").CONNECTED_STATE&&!navigator.userAgent.includes("Firefox")?this.$1=!0:a!==b("MercuryMessageDeliveryState").ERROR&&this.$1&&(this.$1=!1);return o.jsxs(b("Text.react"),{className:"_6934"+(this.$1?"":" noDisplay"),onClick:function(){},children:[i._("\u6b64\u8a0a\u606f\u672a\u9001\u51fa\u3002"),o.jsx("span",{className:"_21c6 error",title:c})]})};d.$11=function(a,c,d){if(!this.state.showTimestamp||a===b("MercuryMessageDeliveryState").ERROR)return null;a=this.props;var e=a.isFromViewer,f=a.lastMessageID,g=a.message,h=a.readReceipt;a=a.showSentAndSeenHead;c=c;!a||h==null||a&&(!e||g.timestamp<h.action&&f!==g.message_id)?c=i._("\u5df2\u8b80"):a&&d&&e&&h!==null&&f!==null&&(c=i._("{seen time}{=Seen}",[i._param("=Seen",o.jsx(b("Text.react"),{style:{fontWeight:"800",paddingRight:"3px"},children:i._("\u5df2\u8b80")})),i._param("seen time",b("MercuryTimestamp").getPreciseTimestamp(h.action))]));g={animation:"fadeIn .1s cubic-bezier(.4,0,.2,1) both",clear:"both",color:"rgba(0, 0, 0, 0.4)","float":"none",fontSize:"12px",fontWeight:"500",paddingLeft:"0px",paddingRight:"0px"};e?(g["float"]="right",g.paddingRight="7px"):(g["float"]="left",g.paddingLeft="3px");return o.jsx(b("Text.react"),{style:g,children:c})};return c}(o.PureComponent);e.exports=a;a.contextType=b("MessagingPluginContext")}),null);
__d("MPNMessageGroup.react",["cx","fbt","MPNMessage.react","MessagingPluginContext","MessagingPluginMobileProfilePicture.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={showTimestamp:!1},c.$2=function(a){if(c.props.isFromViewer)return;c.setState({showTimestamp:a})},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.render=function(){var a,c=this;a=this.props.isFromViewer?null:j.jsx("div",{className:"profilePictureColumn",style:{bottom:this.state.showTimestamp?"15px":"0px"},children:j.jsx(b("MessagingPluginMobileProfilePicture.react"),{personaProfilePictureUri:(a=this.props.persona)==null?void 0:a.profile_picture_url,className:"profilePicture",disableStatusIndicator:!0})});var d=this.props.messages.map(function(a,d){return j.jsx(b("MPNMessage.react"),{connectionState:c.props.connectionState,dateBreakPreceeds:c.props.dateBreakPreceeds&&d===0,deliveryTimestamp:c.props.deliveryTimestamp,isFromViewer:c.props.isFromViewer,isLastMessageInGroup:d===c.props.messages.length-1,lastMessageID:c.props.lastMessageID,lastReadTimestamp:c.props.lastReadTimestamp,message:a,nextMessageTimestamp:c.$1(d),readReceipt:c.props.readReceipt,scrollIntoView:c.props.scrollIntoView,showDeliveryState:a.timestamp>c.props.lastReadTimestamp,showSentAndSeenHead:c.props.nextGroupTimestamp>=c.props.lastReadTimestamp,showTimestampHandler:c.$2,attachmentDidUpdate:a.attachments.length>0},a.message_id)});return j.jsxs("div",{className:"_4xkn clearfix",children:[a,j.jsxs("div",{className:"messages",children:[this.$3(),j.jsx("div",{children:d})]})]})};d.$3=function(){var a=this.context.state.pageName;if(this.props.persona!=null){a=h._("{page name}\u7684{persona name}",[h._param("persona name",this.props.persona.name),h._param("page name",a)]);var b=a.toString();return j.jsx("div",{"aria-label":b,className:"_9e1n",children:a})}return null};d.$1=function(a){return a<this.props.messages.length-1?this.props.messages[a+1].timestamp:this.props.nextGroupTimestamp};return c}(j.PureComponent);e.exports=a;a.contextType=b("MessagingPluginContext")}),null);
__d("MPNMessageList.react",["cx","MPNIdentity","MPNLogMessage.react","MPNMessageGroup.react","MercuryIDs","MercuryMessageGroup","MessagingPluginContext","MessengerDateBreak.re","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react"),j=1e3*60*60;a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.state={messageGroups:b("MercuryMessageGroup").calculateMessageGroups(d.props.messages)},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.UNSAFE_componentWillReceiveProps=function(a){a.messages!==this.props.messages&&this.setState({messageGroups:b("MercuryMessageGroup").calculateMessageGroups(a.messages)})};d.render=function(){var a=b("MPNIdentity").MPNIdentity.currentUserID();if(a==null)return null;var c=[],d=this.state.messageGroups,e=this.props.readReceipt,f=e?e.watermark:0,g=this.props.messages.last()?this.props.messages.last().message_id:null;for(var h=0;h<d.length;h++){var k=h>0?d[h-1]:null;k=k?k[k.length-1]:null;var l=d[h],m=l[0],n=l[l.length-1],o=!1;(!k||m.timestamp-k.timestamp>j)&&(c.push(i.jsx(b("MessengerDateBreak.re").make,{className:"datebreak",date:new Date(m.timestamp)},"db:"+m.message_id)),o=!0);if(m.action_type==="ma-type:log-message"){l.filter(function(a){return a.log_message_type!=="log:error-msg"&&a.log_message_body}).map(function(a){return c.push(i.jsx(b("MPNLogMessage.react"),{message:a},"mg:"+a.message_id))});continue}k=this.$1(d,h);var p=this.$2(e,l,k),q=this.$3(f,n),r=this.$4(n);n=this.$5(n);var s=m.author===b("MercuryIDs").getParticipantIDFromUserID(a);c.push(i.jsx(b("MPNMessageGroup.react"),{persona:n,connectionState:this.props.connectionState,dateBreakPreceeds:o,deliveryTimestamp:r,isFromViewer:s,lastMessageID:g,lastReadTimestamp:q,messages:l,nextGroupTimestamp:k,readReceipt:p?e:null,scrollIntoView:this.props.scrollIntoView},"mg:"+m.message_id))}return c};d.$5=function(a){a=JSON.parse((a=a.platform_xmd)!=null?a:"[]");return a.persona};d.$1=function(a,b){var c=a.length;if(b>=c-1)return Infinity;c=a[b+1][0];if(c.action_type==="ma-type:log-message")return this.$1(a,b+1);else return c.timestamp};d.$3=function(a,b){return b.timestamp>=a?a:Infinity};d.$2=function(a,b,c){return!a?!1:!(b.length===0||a.watermark<b[0].timestamp||a.watermark>=c)};d.$4=function(a){return a.timestamp>this.props.deliveryTimestamp?this.props.deliveryTimestamp:Infinity};return c}(i.PureComponent);e.exports=a;a.contextType=b("MessagingPluginContext")}),null);
__d("MPNQuickReplies.react",["cx","fbt","Image.react","LiveChatPluginLoggerUtil","MPNIdentity","MPNQuickReplyContainer.react","MPNQuickReplyPill.react","MercuryIDs","MercuryMessageActions","MercuryMessageObject","MessagingPluginContext","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(c,d){c=a.call(this,c,d)||this;d=b("MPNIdentity").MPNIdentity.currentUserID();b("MPNIdentity").MPNIdentity.currentUserState()===b("MPNIdentity").MPNIdentityState.FB&&d&&(c.$1=b("MercuryMessageActions").getForFBID(d),c.$2=new(b("MercuryMessageObject"))(d),c.$3=b("MercuryIDs").getThreadIDFromUserID(c.context.state.pageID),c.$4=b("LiveChatPluginLoggerUtil").getAttributionTags());if(c.context.state.hasActiveAutomation&&c.props.quickReplies.length>0){var e=c.props.quickReplies.map(function(a){return a.title});b("LiveChatPluginLoggerUtil").logImpressionEvents("automation_faq_impression",c.context.state.pageID,null,null,null,null,null,null,{faq_titles:JSON.stringify(e)},d)}return c}var d=c.prototype;d.render=function(){var a=this,c=this.props.quickReplies.map(function(c,d){var e=c.content_type;switch(e){case"text":e=c.image_url?j.jsx(b("Image.react"),{className:"_95s6",src:c.image_url}):null;return j.jsxs(b("MPNQuickReplyPill.react"),{onClick:function(){a.$5(c,c.title,d)},children:[e,c.title]},d);case"user_email":case"user_phone_number":case"user_state":case"user_zip_code":return a.$6(c,d);default:return j.jsx(b("MPNQuickReplyPill.react"),{disabled:!0,tooltip:h._("\u82e5\u8981\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u8acb\u4f7f\u7528 Messenger \u61c9\u7528\u7a0b\u5f0f\u3002"),children:c.title},d)}}),d=this.props.type==="horizontal"?"horizontal":"vertical";return j.jsx(b("MPNQuickReplyContainer.react"),{layout:d,children:c})};d.$5=function(a,c,d){var e=this.context.state,f=e.pageID,g=e.accessToken,h=e.messageStore;e=e.hasActiveAutomation;var i=b("MPNIdentity").MPNIdentity.currentUserState();switch(i){case b("MPNIdentity").MPNIdentityState.GUEST:i=h.sendQueue;if(!i)return;i.enqueueAndSend(c,i.makePlatformTokenForQuickReply(a));break;case b("MPNIdentity").MPNIdentityState.FB:if(!this.$1||!this.$2||!this.$3)return;this.$1.send(this.$2.constructCTAConfirmationMessageObject(c,"source:discovery:customer_chat_plugin",this.$3,a,this.$4));break;default:return}h=b("MPNIdentity").MPNIdentity.currentUserID();b("LiveChatPluginLoggerUtil").logActionFromNewUI("in_thread_action",h,f,g?"guest_chat_tab":"logged_in_chat_tab",{action_type:"customer_chat_quick_reply_clicked"});e&&b("LiveChatPluginLoggerUtil").logAction("automation_faq_sent",h,f,null,null,null,null,null,null,{faq_index:d.toString(),faq_title:c})};d.$6=function(a,c){var d=this,e=null;switch(a.content_type){case"user_email":e=this.props.viewerEmail;a.payload=e;break;case"user_phone_number":e=this.props.viewerPhone;a.payload=e;break;case"user_state":e=this.props.viewerState;a.payload=e;break;case"user_zip_code":e=this.props.viewerZipCode;a.payload=e;break;default:break}if(!e)return null;else return j.jsx(b("MPNQuickReplyPill.react"),{onClick:function(){d.$5(a,String(e),c)},children:e},c)};return c}(j.PureComponent);e.exports=a;a.defaultProps={type:"horizontal"};a.contextType=b("MessagingPluginContext")}),null);
__d("LivechatPluginGuestMessageThreadQueryContainer.react",["Arbiter","LiveChatPluginConstants","LiveChatPluginLoggerUtil","LivechatPluginGuestMessageThreadQueryContainerQuery.graphql","RelayModern","getLiveChatPluginGuestUserRelayEnvironment","promiseDone","react"],(function(a,b,c,d,e,f){"use strict";f.LivechatPluginGuestMessageThreadQueryFetchOnce=a;f.LivechatPluginGuestMessageThreadQueryContainer=c;var g,h,i=h||b("react"),j=g!==void 0?g:g=b("LivechatPluginGuestMessageThreadQueryContainerQuery.graphql");function a(a,c){b("promiseDone")(b("RelayModern").fetchQuery(b("getLiveChatPluginGuestUserRelayEnvironment")(),j,{data:{page_id:a}},{force:!0}),function(a){c(a)},function(c){b("LiveChatPluginLoggerUtil").logImpressionEvents("customer_chat_guest_message_list_fetch_failed",a,JSON.stringify({error:c}),null,null,null)})}function c(a){var c=a.pageID;return i.jsx(b("RelayModern").QueryRenderer,{environment:b("getLiveChatPluginGuestUserRelayEnvironment")(),query:j,cacheConfig:{force:!0},variables:{data:{page_id:c}},render:function(a){var d=a.error;a=a.props;if(d){b("LiveChatPluginLoggerUtil").logImpressionEvents("customer_chat_guest_message_list_fetch_failed",c,JSON.stringify({error:d}),null,null,null);return}b("Arbiter").inform(b("LiveChatPluginConstants").UPDATE_MESSAGE_LIST,a);return i.jsx("div",{})}})}}),null);
__d("MercurySyncReadReceiptTransformer",[],(function(a,b,c,d,e,f){"use strict";f.transform=a;function a(a){var b={watermark:parseInt(a.watermarkTimestampMs,10),action:parseInt(a.actionTimestampMs,10)},c=a.threadKey.otherUserFbId||a.actorFbId;a=a.threadKey.otherUserFbId||a.threadKey.threadFbId;var d={roger:{}};d.roger[a]={};d.roger[a][c]=b;return d}}),null);
__d("MessagingPluginGraphQLUtils",["MNCommerceCallToActionType","immutable"],(function(a,b,c,d,e,f){f.getMercuryPayloadFromGraphQLResponse=a;f.getMercuryPayloadFromOptimisticMessage=c;f.getLatestReadReceiptFromGraphQLResponse=d;f.getGuestThreadUnreadCount=e;f._hasAttachments=g;f._hasBlobAttachments=h;f._hasXMA=i;f._getAttachments=j;f._getBlobAttachments=k;f._getXMAFromMessageNode=l;f._buildSubattachmentsFromParentStory=m;f._getTargetTitleFromGraphQLTarget=n;f._getTargetItemsFromGraphQLTarget=o;f._getMercuryBusinessItemFromGraphQL=p;f._getMediaBlobAttachmentFromGraphQL=q;f._getMercuryCallToActionFromGraphQL=r;f._getAuthorFbid=s;function a(a){if(a==null)return null;if(a.guest_message_thread!=null&&a.guest_message_thread.messages!=null){var c=b("immutable").List(a.guest_message_thread.messages.nodes).map(function(b){return{action_type:b.extensible_message_admin_text_type!=null?"ma-type:log-message":"ma-type:user-generated-message",has_attachment:g(b),attachments:j(b),author:s(b.message_sender),author_email:b.message_sender&&b.message_sender.email,body:b.message&&b.message.text,folder:a.guest_message_thread&&a.guest_message_thread.folder,is_filtered_content:!1,is_sponsored:b.is_sponsored,thread_id:b.message_thread_key&&b.message_thread_key.other_user_id,thread_fbid:b.message_thread_key&&b.message_thread_key.thread_fbid,message_id:b.message_id,timestamp:Number(b.timestamp_precise),platform_xmd:b.platform_xmd_encoded,source:b.tags_list,is_unread:b.unread,offline_threading_id:b.offline_threading_id,log_message_body:b.snippet}});return c}return null}function c(a,b,c){return a.map(function(a){return{action_type:"ma-type:send-message",attachments:[],author:"fbid:"+b,author_email:b+"@facebook.com",body:a.body,folder:"INBOX",has_attachment:!1,is_filtered_content:!1,is_sponsored:!1,thread_id:c,thread_fbid:null,message_id:a.otid,timestamp:a.timestamp,source:[],is_unread:!1,offline_threading_id:a.otid,status:a.state}})}function d(a){var b;if(a==null)return null;if(((b=a.guest_message_thread)==null?void 0:(b=b.last_read_receipt)==null?void 0:b.nodes)!=null&&((b=a.guest_message_thread)==null?void 0:(b=b.last_read_receipt)==null?void 0:(b=b.nodes)==null?void 0:b.length)>0){b=a.guest_message_thread.last_read_receipt.nodes[0];return{action:Number(b.action),watermark:Number(b.watermark)}}return null}function e(a){return a==null?void 0:(a=a.guest_message_thread)==null?void 0:a.unread_count}function g(a){return h(a.blob_attachments)||i(a.extensible_attachment)}function h(a){return a!==null}function i(a){return a!=null}function j(a){return k(a.blob_attachments).concat(l(a))}function k(a){return!a?[]:a.map(function(a){if(a.video_type!=null)return{app_attribution:null,attach_type:"video",blurred_image_uri:null,icon_type:"attach:video",large_preview_url:a.image.uri,large_preview_height:null,large_preview_width:null,name:null,photo_encodings:[],preview_height:null,preview_url:null,preview_width:null,rel:"async",share:null,thumbnail_url:a.playable_url,url:a.playable_url,metadata:{fbid:a.legacy_attachment_id,dimensions:{width:a.original_dimensions.x,height:a.original_dimensions.y}}};else if(a.file_type!=null)return{app_attribution:null,attach_type:"file",blurred_image_uri:null,icon_type:"attach:file",large_preview_url:null,large_preview_height:null,large_preview_width:null,metadata:null,name:a.filename,photo_encodings:[],preview_height:null,preview_url:null,preview_width:null,rel:"async",share:null,thumbnail_url:null,url:a.url};else return{app_attribution:null,attach_type:"photo",blurred_image_uri:null,icon_type:"attach:image",large_preview_url:a.image.uri,large_preview_height:a.image.height,large_preview_width:a.image.width,metadata:null,name:null,photo_encodings:[],preview_height:null,preview_url:null,preview_width:null,rel:"async",share:null,thumbnail_url:null,url:null}})}function l(a){var b,c=a.extensible_attachment;if(!c)return[];c=c.story_attachment;var d=c.target;return[{app_attribution:null,attach_type:"share",blurred_image_uri:null,icon_type:null,large_preview_url:null,large_preview_height:null,large_preview_width:null,metadata:null,name:null,photo_encodings:[],preview_height:null,preview_url:null,preview_width:null,rel:"async",thumbnail_url:null,url:null,share:{action_links:[],deduplication_key:c.deduplication_key,media:{animated_image:(b=c.media)==null?void 0:(b=b.animated_image)==null?void 0:b.uri,animated_image_size:{height:(b=c.media)==null?void 0:(b=b.animated_image)==null?void 0:b.height,width:(b=c.media)==null?void 0:(b=b.animated_image)==null?void 0:b.width},image:(b=c.media)==null?void 0:(b=b.image)==null?void 0:b.uri,image_size:{height:(b=c.media)==null?void 0:(b=b.image)==null?void 0:b.height,width:(b=c.media)==null?void 0:(b=b.image)==null?void 0:b.width},playable:(b=c.media)==null?void 0:b.is_playable},messenger_ctas:[],properties:{},share_id:a.message_id,source:(b=c.source)==null?void 0:b.text,style_list:c.style_list,subattachments:m(c),target:{call_to_actions:(b=(a=d.call_to_actions)==null?void 0:a.map(function(a){return r(a)}))!=null?b:[],items:o(d),message:d.snippet},title:n(d),uri:d.url}}]}function m(a){if(!a||!a.target)return[];if(!a.subattachments)return[];var b=o(a.target);return a.subattachments.map(function(a,c){var d;return{action_links:[],deduplication_key:a.deduplication_key,media:{animated_image:(d=a.media)==null?void 0:(d=d.animated_image)==null?void 0:d.uri,animated_image_size:{height:(d=a.media)==null?void 0:(d=d.animated_image)==null?void 0:d.height,width:(d=a.media)==null?void 0:(d=d.animated_image)==null?void 0:d.width},image:(d=a.media)==null?void 0:(d=d.image)==null?void 0:d.uri,image_size:{height:(d=a.media)==null?void 0:(d=d.image)==null?void 0:d.height,width:(d=a.media)==null?void 0:(d=d.image)==null?void 0:d.width},playable:(d=a.media)==null?void 0:d.is_playable},messenger_ctas:[],properties:{},source:a.source.text,style_list:a.style_list,target:b[c]}})}function n(a){a=a.business_items;if(!a||!a.nodes)return"";var b="";for(var c=0;c<a.nodes.length-1;c++)b=b+a.nodes[c].name+", ";a.nodes[a.nodes.length-1]&&(b+=a.nodes[a.nodes.length-1].name);return b}function o(a){a=a.business_items;return!a||!a.nodes?[]:a.nodes.map(function(a){return p(a)})}function p(a){return!a?null:{call_to_actions:a.call_to_actions.map(function(a){return r(a)}),default_action:r(a.default_action),desc:a.description,id:a.id,image_aspect_ratio:a.image_aspect_ratio,item_url:a.target_url,media_blob_attachments:a.media_blob_attachments.map(function(a){return q(a)}),metalines:{metaline_1:a.first_metaline,metaline_2:a.second_metaline,metaline_3:a.third_metaline},name:a.name,source:a.source_name,text:"",thumb_url:a.image_url,title:a.name}}function q(a){return!a?null:{playable_url:a.playable_url,height:a.height,width:a.width,id:a.id}}function r(a){return!a?null:{action_link:a.action_url,action_type:b("MNCommerceCallToActionType")[a.action_open_type],action_open_type:a.action_open_type,action_objects:[{}],id:a.id,is_disabled:a.is_disabled,is_mutable_by_server:a.is_mutable_by_server,logging_token:a.logging_token,page_id:a.page_id,payment_metadata:null,render_style:a.cta_render_style,should_show_user_confirmation:!1,title:a.action_title,webview_metadata:null}}function s(a){return a!=null&&a.id!=null?"fbid:"+a.id:""}}),null);
__d("MessagingPluginPendingMessageState",[],(function(a,b,c,d,e,f){"use strict";a=0;f.SENDING=a;b=1;f.SENT=b;c=4;f.FAILED=c}),null);
__d("MessagingPluginGuestSendTextMessage",["MessagingPluginGuestSendTextMessageMutation.graphql","RelayModern","getLiveChatPluginGuestUserRelayEnvironment"],(function(a,b,c,d,e,f){"use strict";f.commit=a;var g;function a(a,c){b("RelayModern").commitMutation(b("getLiveChatPluginGuestUserRelayEnvironment")(),{mutation:g!==void 0?g:g=b("MessagingPluginGuestSendTextMessageMutation.graphql"),variables:a,onCompleted:c&&c.onSuccess,onError:c&&c.onFailure})}}),null);
__d("MessagingPluginSendQueue",["CurrentUser","LiveChatPluginLocalStorageUtil","LiveChatPluginLoggerUtil","MessagingPluginGuestSendTextMessage","MessagingPluginPendingMessageState","Random","immutable"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,c,d,e){this.isSending=!1,this.pageID=a,this.userID=c,this.sessionKey=d,this.pendingMessages=b("immutable").List(),this.serverPartialMessages=b("immutable").List(),this.failedMessages=b("immutable").List(),this.updateMessageStoreCallback=e,this.requestID=b("LiveChatPluginLocalStorageUtil").getRequestID()}var c=a.prototype;c.getOptimisticMessages=function(){return this.pendingMessages.concat(this.failedMessages).concat(this.serverPartialMessages).sort(function(a,b){return a.timestamp-b.timestamp})};c.confirmServerPartialMessages=function(a){this.serverPartialMessages=this.serverPartialMessages.filter(function(b){var c=a.find(function(a){return a.otid===b.otid});return!c})};c.makePlatformTokenForPostbackCTA=function(a){return JSON.stringify({postback:{cta_id:a,prev_message_id:null,force_handle:!0,ref:null}})};c.makePlatformTokenForQuickReply=function(a){return JSON.stringify({quick_reply:{payload:a.payload}})};c.enqueueAndSend=function(a,c){var d=this.makeOfflineThreadingID();this.pendingMessages=this.pendingMessages.push({otid:d,body:a,timestamp:Date.now(),platformToken:c,state:b("MessagingPluginPendingMessageState").SENDING});this.updateMessageStoreCallback&&this.updateMessageStoreCallback();this.isSending||this.sendNext()};c.sendNext=function(){if(this.pendingMessages.size===0){this.isSending=!1;return}this.isSending=!0;var a=this.pendingMessages.first();this.performMutation(a)};c.performMutation=function(a){var c=this,d=b("CurrentUser").getID()!=="0";d={requestID:this.requestID,isLoggedIn:d.toString()};b("MessagingPluginGuestSendTextMessage").commit({input:{client_mutation_id:a.otid,message_text:a.body,platform_token:a.platformToken,page_id:this.pageID,logging_extra:JSON.stringify(d)}},{onSuccess:function(a){a=c.pendingMessages.first();c.pendingMessages=c.pendingMessages.slice(1);c.serverPartialMessages=c.serverPartialMessages.push(babelHelpers["extends"]({},a,{state:b("MessagingPluginPendingMessageState").SENT}));c.updateMessageStoreCallback&&c.updateMessageStoreCallback();c.sendNext()},onFailure:function(d){var e="text";try{if(a.platformToken!=null){var f=JSON.parse(a.platformToken);(f==null?void 0:f.postback)!=null?e="postback":(f==null?void 0:f.quick_reply)!=null&&(e="quick_reply")}}catch(a){}b("LiveChatPluginLoggerUtil").logImpressionEvents("customer_chat_guest_message_send_failed",c.pageID,JSON.stringify({error:d,message_type:e}),null,null,null);f=c.pendingMessages.first();c.pendingMessages=c.pendingMessages.slice(1);c.failedMessages=c.failedMessages.push(babelHelpers["extends"]({},f,{state:b("MessagingPluginPendingMessageState").FAILED}));c.updateMessageStoreCallback&&c.updateMessageStoreCallback();c.sendNext()}})};c.makeOfflineThreadingID=function(){var a=Date.now(),c=b("Random").uint32();a=a&2147483647;a=a*Math.pow(2,21);c=(c&2097151)+a;return c.toString()};return a}();e.exports=a}),null);
__d("XMNMessagingPluginGuestExpirationAdminTextController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/plugins/live_chat/guest_expiration_admin_text/",{page_id:{type:"FBID",required:!0},access_token:{type:"String",required:!0}})}),null);
__d("LiveChatMessageStore",["Arbiter","AsyncRequest","LiveChatPluginConstants","LiveChatPluginLoggerUtil","LivechatPluginGuestMessageThreadQueryContainer.react","MercuryIDs","MercuryMessageStore","MercurySyncDeltaTypes","MercurySyncNewMessageTransformer","MercurySyncReadReceiptTransformer","MercuryThreadlistConstants","MessagingPluginGraphQLUtils","MessagingPluginPendingMessageState","MessagingPluginSendQueue","MessengerMQTTConnectionEvents","Sound","SubscriptionsHandler","UserActivity","XMNMessagingPluginGuestExpirationAdminTextController","gkx","immutable","mixInEventEmitter","setTimeout"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,c,d,e,f,g){this.$5=c||b("LiveChatPluginConstants").LOGGED_IN_CHAT_MODE,this.$4=a,this.$1=d,this.$2=e,this.$7=b("immutable").List(),this.$8=b("immutable").List(),this.$10=null,this.$9={action:0,watermark:0},this.$12=new Set(),this.$11=f,this.$13=g,this.$14=!1,this.$5===b("LiveChatPluginConstants").LOGGED_IN_CHAT_MODE?this.$15():this.$16()}var c=a.prototype;c.$17=function(a){var c=b("MercurySyncNewMessageTransformer").transform(this.$1,a);a["class"]==b("MercurySyncDeltaTypes").AdminTextMessage&&(c=babelHelpers["extends"]({},c,{action_type:"ma-type:log-message",log_message_body:a.messageMetadata.adminText}));return c};c.$18=function(a){var c=this.$7||b("immutable").List();c=c.push(a);var d=new Map();c.forEach(function(a){d.set(a.offline_threading_id,a)});var e=b("immutable").List();d.forEach(function(a){e=e.push(a)});return e};c.$15=function(){var a=this;this.$6&&this.$6.destroy();this.$3&&this.$3.release();this.$6=new(b("MercuryMessageStore"))(this.$4,null,this.$1);this.$3=new(b("SubscriptionsHandler"))();if(this.$3==null||this.$6==null)return;var c=b("gkx")("1872058");this.$3.addSubscriptions(this.$6.subscribe(function(d){var e=b("immutable").List(d.messages.sort(function(a,b){return a.timestamp-b.timestamp}));if(c){var f=a.$7||b("immutable").List(),g=new Map();f.forEach(function(a){g.set(a.offline_threading_id,a)});e.forEach(function(a){g.set(a.offline_threading_id,a)});var h=b("immutable").List();g.forEach(function(a){h=h.push(a)});a.$7=h}else a.$7=e;a.$19(d.eventType)}));c&&this.$3.addSubscriptions(b("Arbiter").subscribe(b("MessengerMQTTConnectionEvents").DELTA_EVENT,function(c,d){c=d.obj.delta;if(c["class"]===b("MercurySyncDeltaTypes").NewMessage||c["class"]===b("MercurySyncDeltaTypes").AdminTextMessage){d=a.$17(c);a.$7=a.$18(d);a.$19(b("LiveChatPluginConstants").NEW_MESSAGE_UPDATE)}}))};c.$16=function(){var a=this;this.$6&&this.$6.destroy();this.$3&&this.$3.release();this.$3=new(b("SubscriptionsHandler"))();if(this.$3==null)return;this.$3.addSubscriptions(b("Arbiter").subscribe(b("MessengerMQTTConnectionEvents").DELTA_EVENT,function(c,d){c=d.obj.delta;b("LiveChatPluginLoggerUtil").logDelta(a.$1,a.$2,c["class"],c.seqID,!0);if(c["class"]!==b("MercurySyncDeltaTypes").NewMessage&&c["class"]!==b("MercurySyncDeltaTypes").ReadReceipt&&c["class"]!==b("MercurySyncDeltaTypes").MarkRead&&c["class"]!==b("MercurySyncDeltaTypes").AdminTextMessage)return;if(c["class"]===b("MercurySyncDeltaTypes").ReadReceipt){d=b("MercurySyncReadReceiptTransformer").transform(c);d=d.roger[a.$2][a.$2];a.$9=d;return}else if(c["class"]===b("MercurySyncDeltaTypes").MarkRead)a.$10=0,a.$12.clear(),b("Arbiter").inform(b("LiveChatPluginConstants").UNREAD_COUNT_UPDATE,0);else{d=a.$17(c);a.$20(d);d.author!=b("MercuryIDs").getParticipantIDFromUserID(a.$1)&&!a.$12.has(d.message_id)&&c["class"]===b("MercurySyncDeltaTypes").NewMessage&&(a.$10!=null?a.$10+=1:a.$10=1,a.$12.add(d.message_id),b("Arbiter").inform(b("LiveChatPluginConstants").UNREAD_COUNT_UPDATE,a.$10),a.$21(d.timestamp));if(!a.$14&&d.action_type==="ma-type:user-generated-message"){c=b("XMNMessagingPluginGuestExpirationAdminTextController").getURIBuilder().setString("access_token",a.$13).setFBID("page_id",a.$2).getURI();new(b("AsyncRequest"))().setURI(c).send();a.$14=!0}c=a.$7||b("immutable").List();c=c.push(d);var e=new Map();c.forEach(function(a){e.set(a.message_id,a)});var f=b("immutable").List();e.forEach(function(a){f=f.push(a)});a.$7=f;a.$19(b("LiveChatPluginConstants").NEW_MESSAGE_UPDATE);return}}));this.$22()};c.$22=function(){var a=this;b("LivechatPluginGuestMessageThreadQueryContainer.react").LivechatPluginGuestMessageThreadQueryFetchOnce(this.$2,function(c){var d;a.$9=(d=a.$9)!=null?d:b("MessagingPluginGraphQLUtils").getLatestReadReceiptFromGraphQLResponse(c);d=b("MessagingPluginGraphQLUtils").getGuestThreadUnreadCount(c);a.$10===null&&d!=null&&(a.$10=d,b("Arbiter").inform(b("LiveChatPluginConstants").UNREAD_COUNT_UPDATE,a.$10));d=b("MessagingPluginGraphQLUtils").getMercuryPayloadFromGraphQLResponse(c);d=d||b("immutable").List();var e=new Map();d=d.concat(a.$7);d.forEach(function(a){e.set(a.message_id,a)});var f=b("immutable").List();e.forEach(function(b){!a.$14&&b.action_type==="ma-type:user-generated-message"&&(a.$14=!0),a.$20(b),f=f.push(b)});a.$7=f;b("setTimeout")(function(){a.$19(b("LiveChatPluginConstants").INITIAL_FETCH)},1e3)})};c.getMessageListWithOptimisticMessages=function(){var a=this;if(!this.sendQueue)return this.$7;var c=this.sendQueue.getOptimisticMessages(),d=c.filter(function(b){var c=a.$7.find(function(a){return a.offline_threading_id===b.otid});return c!=null});c=c.filter(function(a){var b=d.find(function(b){return b.otid===a.otid});return!b});this.sendQueue&&this.sendQueue.confirmServerPartialMessages(d);c=c.map(function(a){return a.state===b("MessagingPluginPendingMessageState").FAILED?a:babelHelpers["extends"]({},a,{timestamp:a.timestamp+6e5})});c=b("MessagingPluginGraphQLUtils").getMercuryPayloadFromOptimisticMessage(c,this.$1,this.$2);return this.$7.concat(c).sort(function(a,b){return a.timestamp-b.timestamp})};c.setUpGuestMessageSendQueue=function(a){this.sendQueue=new(b("MessagingPluginSendQueue"))(this.$2,this.$1,a,this.optimisticSendUpdateCallback.bind(this))};c.destroy=function(){this.$6&&this.$6.destroy(),this.$3&&this.$3.release(),this.$7=b("immutable").List()};c.subscribe=function(a){return this.addRetroactiveListener("messageUpdate",a)};c.fetchMoreMessages=function(){return this.$5===b("LiveChatPluginConstants").LOGGED_IN_CHAT_MODE?this.$6!=null&&this.$6.fetchMoreMessages():!1};c.hasFetchedAll=function(){return this.$5===b("LiveChatPluginConstants").LOGGED_IN_CHAT_MODE?this.$6!=null&&this.$6.hasFetchedAll()||this.$7.size>=b("MercuryThreadlistConstants").RECENT_MESSAGES_LIMIT:!0};c.optimisticSendUpdateCallback=function(){this.$19(b("LiveChatPluginConstants").NEW_MESSAGE_UPDATE)};c.getLatestReadReceipt=function(){return this.$9};c.$21=function(a){if(!b("UserActivity").isOnTab()){var c,d;c=(c=this.$11)==null?void 0:c.get("sound.notif_ogg_url");d=(d=this.$11)==null?void 0:d.get("sound.notif_mp3_url");c!=null&&d!=null&&b("Sound").play([c,d],a,!1)}};c.$20=function(a){a.timestamp>this.$9.action&&a.author!=b("MercuryIDs").getParticipantIDFromUserID(this.$1)&&(this.$9.action=a.timestamp,this.$9.watermark=a.timestamp)};c.$19=function(a){var b=this.getMessageListWithOptimisticMessages();this.$8=b;this.releaseHeldEventType("messageUpdate");this.emitAndHold("messageUpdate",{messages:b,eventType:a})};return a}();e.exports=a;b("mixInEventEmitter")(a,{messageUpdate:!0})}),null);
__d("MessengerViewerContactMethodsWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1868889766468115"};b.getQueryID=function(){return"177554543035925"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("XMessagingPluginMarkReadController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/plugins/live_chat/mark_read/",{access_token:{type:"String"},ids:{type:"StringToBoolMap",required:!0},watermark_timestamp:{type:"Int"}})}),null);
__d("MessagingPluginDialogBody.react",["cx","fbt","Arbiter","AsyncRequest","DOM","Event","LiveChatMessageStore","LiveChatPluginConstants","LiveChatPluginLoggerUtil","LiveChatPluginTypingIndicator.react","MPNConstants","MPNIcebreakers.react","MPNIdentity","MPNLocalState","MPNMessageList.react","MPNQuickReplies.react","MPNStorage","MPNXDMessageManager","MercuryIDs","MessagingPluginContext","MessengerDeliveryReceipt.bs","MessengerScrollableArea.react","MessengerSpinner.react","MessengerUserProfileLocationUtils","MessengerViewerContactMethodsWebGraphQLQuery","ReactDOM","SubscriptionsHandler","UserActivity","WebGraphQL","XMessagingPluginMarkReadController","clearTimeout","gkx","immutable","promiseDone","react","setTimeout"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react"),k=35,l=4e3;a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.state={connectionState:b("LiveChatPluginConstants").CONNECTED_STATE,messages:b("immutable").List(),quickRepliesOffset:0,readReceipt:null,showConnectionBanner:!1,typing:!1,viewerEmail:null,viewerPhone:null,viewerState:null,viewerZipCode:null,shouldShowIcebreakers:!1,shouldShowWelcomeMessage:!1,unreadCount:0,userID:b("MPNIdentity").MPNIdentity.currentUserID(),hasLoggedImpression:!1},d.$2=!1,d.$3=null,d.$4=0,d.$5=0,d.$9="",d.$12=null,d.$25=function(a,b){var c=d.$16();if(!c)return;var e=c.getScrollOffsetForElement(a);a=e+a.offsetHeight;var f=c.getScrollTop(),g=f+c.getClientHeight();a=a-g;if(e<=f){g=b?Math.max(0,e-30):e;c.setScrollTop(g,!0)}else a>-15&&a<36&&c.setScrollTop(f+Math.abs(a)+15,!0)},d.$30=function(){b("setTimeout")(function(){d.$21()},l)},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.componentDidMount=function(){var a=this,c=this.context.state,d=c.pageID,e=c.pageName;c=c.hasAutomation;this.$2=!0;this.$9=b("MercuryIDs").getThreadIDFromUserID(d);this.$14();this.$12=b("Arbiter").subscribe(b("LiveChatPluginConstants").UNREAD_COUNT_UPDATE,function(b,c){a.setState({unreadCount:c}),a.$15(e)});b("MPNIdentity").MPNIdentity.currentUserState()!==b("MPNIdentity").MPNIdentityState.FB&&!c&&this.setState({shouldShowIcebreakers:!0})};d.componentWillUnmount=function(){this.$2=!1,this.$7&&this.$7.destroy(),this.$8&&this.$8.release(),this.$12&&b("Arbiter").unsubscribe(this.$12),this.$13&&b("clearTimeout")(this.$13),this.context.state.hasActiveAutomation&&this.context.dispatchAction({type:"TOGGLE_HAS_ACTIVE_AUTOMATION",hasActiveAutomation:!1})};d.UNSAFE_componentWillUpdate=function(){var a=this.$16();a&&(this.$4=a.getScrollHeight(),this.$5=a.getScrollTop())};d.componentDidUpdate=function(a,c){a=b("MPNIdentity").MPNIdentity.currentUserID();(this.state.userID!==a||this.context.state.messageStore==null)&&(this.setState({userID:a}),this.$14());this.$17(this.state.messages);var d=this.$18();if(d){var e=!1,f=!1;d.data.forEach(function(a){a.content_type==="user_email"||a.content_type==="user_phone_number"?e=!0:(a.content_type==="user_setstate"||a.content_type==="user_zip_code")&&(f=!0)});e&&this.$19();f&&this.$20()}if(((d=b("MPNStorage").getFBStorageState())==null?void 0:d.visibility)==="not-hidden"&&this.state.unreadCount>0){d=b("XMessagingPluginMarkReadController").getURIBuilder().setString("access_token",this.context.state.accessToken).setStringToBoolMap("ids",(d={},d[this.context.state.pageID]=!0,d)).setInt("watermark_timestamp",Date.now()).getURI();new(b("AsyncRequest"))().setURI(d).send();this.setState({unreadCount:0});b("MPNXDMessageManager").setTabNotification(null)}d=this.$16();var g=b("ReactDOM").findDOMNode(this);if(!g||!(g instanceof HTMLElement)||a==null)return;g=g.clientHeight;if(this.$1){var h=b("ReactDOM").findDOMNode(this.$1);h&&h instanceof HTMLElement&&(this.state.quickRepliesOffset!==g-h.clientHeight&&this.setState({quickRepliesOffset:g-h.clientHeight}))}if(!d)return;g=this.state.messages!==c.messages&&this.state.messages.last()!==c.messages.last()&&!this.state.messages.isEmpty()&&this.state.messages.last().author===b("MercuryIDs").getParticipantIDFromUserID(a);if(g)this.$21(),this.$22();else{h=d.getScrollHeight();if(h!==this.$4){c=h-this.$4+this.$5;this.$6&&this.$6.scrollToPosition(c)}else this.$22()}if(this.$10){a=b("ReactDOM").findDOMNode(this.$10);a instanceof HTMLElement&&d.distanceToBottom()<=1.25*a.offsetHeight?d.scrollToBottom(!0):a&&(this.$6&&this.$6.scrollToPosition(this.$5))}};d.render=function(){var a=this,c=this.context.state.pageID;try{var d;return j.jsxs(j.Fragment,{children:[this.$23(),j.jsx(b("MessengerScrollableArea.react"),{className:b("gkx")("1990737")?"_9qci":"",height:this.$24(),ref:function(b){a.$6=b},tabIndex:0,children:j.jsxs("div",{ref:function(b){a.$1=b},children:[j.jsx("div",{className:"preventScrollOverflow",children:j.jsxs("div",{className:"conversationContainer",children:[j.jsx(b("MPNMessageList.react"),{connectionState:this.state.connectionState,deliveryTimestamp:b("MessengerDeliveryReceipt.bs").getDeliveryTimeOfThread(this.props.deliveryReceipt,this.$9),messages:this.state.messages,shouldShowWelcomeMessage:this.state.shouldShowWelcomeMessage,readReceipt:(d=this.state.readReceipt)!=null?d:(d=this.$7)==null?void 0:d.getLatestReadReceipt(),scrollIntoView:this.$25}),j.jsx(b("LiveChatPluginTypingIndicator.react"),{pageIsTyping:this.state.typing,ref:function(b){a.$10=b}})]})}),j.jsxs("div",{style:{position:"relative",top:Math.max(this.state.quickRepliesOffset,0)},children:[this.$26(),this.state.shouldShowIcebreakers?j.jsx(b("MPNIcebreakers.react"),{threadID:this.$9}):null]})]})},"scrollable_area")]})}catch(a){d=this.context.state.showUpgradeUpsellPrompt;b("LiveChatPluginLoggerUtil").logImpressionExceptionsFromNewUI("tab_load_failure",c,b("MPNIdentity").MPNIdentity.currentUserState()===b("MPNIdentity").MPNIdentityState.FB?"logged_in_chat_tab":d?"guest_chat_tab_with_upgrade_enabled":"guest_chat_tab",a.name,a.message,a.stack);return null}};d.$15=function(a){a=h._("{pageName}\u50b3\u9001\u4e86\u8a0a\u606f\u7d66\u4f60",[h._param("pageName",a)]).toString();b("MPNXDMessageManager").setTabNotification(a);b("UserActivity").subscribeOnce(function(){b("MPNXDMessageManager").setTabNotification(null)})};d.$26=function(){var a=this.$18();return!a?null:j.jsx(b("MPNQuickReplies.react"),{quickReplies:a.data,type:a.type,viewerEmail:this.state.viewerEmail,viewerPhone:this.state.viewerPhone,viewerState:this.state.viewerState,viewerZipCode:this.state.viewerZipCode})};d.$27=function(){var a=b("MPNIdentity").MPNIdentity.currentUserID(),c=this.context.state,d=c.pageID,e=c.continueClickTime,f=c.pluginMountTime;c=c.showUpgradeUpsellPrompt;if(b("gkx")("1877511")){var g;b("LiveChatPluginLoggerUtil").logImpressionUsingFalco(d,b("MPNIdentity").MPNIdentity.currentUserState()===b("MPNIdentity").MPNIdentityState.FB?"logged_in_chat_tab":c?"guest_chat_tab_with_upgrade_enabled":"guest_chat_tab",(g=e)!=null?g:f,null,null,null,a)}else{b("LiveChatPluginLoggerUtil").logImpressionFromNewUI("tab_impression",d,b("MPNIdentity").MPNIdentity.currentUserState()===b("MPNIdentity").MPNIdentityState.FB?"logged_in_chat_tab":c?"guest_chat_tab_with_upgrade_enabled":"guest_chat_tab",(g=e)!=null?g:f,null,null,null,null,a)}};d.$28=function(a,c,d){if(a!==b("LiveChatPluginConstants").GUEST_CHAT_MODE||!this.context.state.showUpgradeUpsellPrompt||this.context.state.isInstantlyResponsive||this.context.state.isPageInEU)return b("MPNConstants").MPNUpgradePrompt.NOT_SHOWN;if(this.context.state.hasAutomation){if(this.$29(c))return b("MPNConstants").MPNUpgradePrompt.DONT_WAIT_FOR_REPLY_UPSELL}else{var e=b("MPNIdentity").MPNIdentity.currentUserID();d===b("LiveChatPluginConstants").NEW_MESSAGE_UPDATE?a=c.butLast():a=c;this.$3==null&&(this.$3=a.some(function(a){return b("MercuryIDs").getUserIDFromParticipantID(a.author)==e}));if(!this.$3&&c.get(-1)!=null&&c.get(-1).author!=null&&b("MercuryIDs").getUserIDFromParticipantID(c.get(-1).author)===e){this.$3=!0;return b("MPNConstants").MPNUpgradePrompt.DONT_WAIT_FOR_REPLY_UPSELL}}return b("MPNConstants").MPNUpgradePrompt.NOT_SHOWN};d.$14=function(){var a=this;this.$7&&this.$7.destroy();this.$8&&this.$8.release();this.setState({hasLoggedImpression:!1});var c=b("MPNIdentity").MPNIdentity.currentUserID();if(c==null)return;if(this.context.state.optimisticStorageState.chatState!=b("MPNLocalState").MPNChatState.CHAT_NOT_STARTED){var d=this.context,e=d.state,f=d.dispatchAction;d=b("MPNIdentity").MPNIdentity.currentUserState();var g=d===b("MPNIdentity").MPNIdentityState.FB?b("LiveChatPluginConstants").LOGGED_IN_CHAT_MODE:d===b("MPNIdentity").MPNIdentityState.GUEST?b("LiveChatPluginConstants").GUEST_CHAT_MODE:null;this.$7=new(b("LiveChatMessageStore"))(this.$9,g,c,this.context.state.pageID,this.context.state.soundURLs,e.accessToken);f({type:"SET_UP_MESSAGE_STORE",messageStore:this.$7});e.accessToken&&(this.$7&&this.$7.setUpGuestMessageSendQueue(e.accessToken));this.$8=new(b("SubscriptionsHandler"))();if(this.$8===null)return;this.$8!=null&&this.$8.addSubscriptions(b("Arbiter").subscribe(b("LiveChatPluginConstants").TYPING_UPDATE,function(c,d){d=!!d,d!==a.state.typing&&(a.setState({typing:d}),d&&(a.$11=b("setTimeout")(function(){a.setState({typing:!1})},15e3)))}),b("Arbiter").subscribe(b("LiveChatPluginConstants").STATE_UPDATE,function(d,c){d=null;c!==a.state.connectionState&&(a.setState({connectionState:c},a.$30),b("clearTimeout")(d),d=b("setTimeout")(function(){a.setState({showConnectionBanner:!0})},l))}));this.$8!=null&&this.$7!=null&&this.$8.addSubscriptions(this.$7.subscribe(function(d){a.setState(function(e){var h=b("immutable").List(d.messages.sort(function(a,b){return a.timestamp-b.timestamp}));!a.context.state.threadExists&&h.size>=1&&f({type:"UPDATE_THREAD_EXISTS"});var i=a.$28(g,h,d.eventType);i===b("MPNConstants").MPNUpgradePrompt.DONT_WAIT_FOR_REPLY_UPSELL&&i!==a.context.state.optimisticStorageState.showUpgradePromptType&&(b("MPNStorage").setShowUpgradePrompt(i),f({type:"UPDATE_UPGRADE_UPSELL_PROMPT",upgradeUpsellPrompt:i}));i={};h.get(-1)!=null&&h.get(-1).author!=null&&b("MercuryIDs").getUserIDFromParticipantID(h.get(-1).author)!==c&&e.typing&&(a.$11&&b("clearTimeout")(a.$11),i.typing=!1);var j=e.hasLoggedImpression;!e.hasLoggedImpression&&a.$7!=null&&a.$7.hasFetchedAll()&&(a.$27(),j=!0);return babelHelpers["extends"]({messages:h,readReceipt:(e=a.$7)==null?void 0:e.getLatestReadReceipt(),shouldShowIcebreakers:a.$31(h),shouldShowWelcomeMessage:!0,hasLoggedImpression:j},i)})}))}};d.$31=function(a){var c=this.context.state.hasAutomation,d=b("MPNIdentity").MPNIdentity.currentUserState();d===b("MPNIdentity").MPNIdentityState.FB?d=!(c&&b("gkx")("1943829"))&&this.$7!=null&&this.$7.hasFetchedAll()&&a.size===0:d=!c&&(a.size===0||this.$7!=null&&this.$7.hasFetchedAll()&&a.size===1&&a.get(0).action_type==="ma-type:log-message");return d};d.$16=function(){return this.$6&&this.$6.getArea()};d.$21=function(){this.$6&&this.$6.scrollToBottom()};d.$32=function(){var a=b("ReactDOM").findDOMNode(this);return a&&a.parentNode&&a.parentNode instanceof HTMLElement?a.parentNode.getBoundingClientRect().height+"px":"100%"};d.$22=function(){var a=this;b("DOM").scry(b("ReactDOM").findDOMNode(this),"img").forEach(function(c){if(c.complete)return;var d=b("Event").listen(c,"load",function(){a.$21(),d.remove()})})};d.$24=function(){var a;!this.context.state.isMobile?a="100%":a=(this.props.dialogBodyHeight===-1?this.$32():this.props.dialogBodyHeight)+"px";this.state.showConnectionBanner&&!navigator.userAgent.includes("Firefox")&&(a=a==="100%"?"91%":Math.max(parseInt(a,10)-k,0).toString()+"px");return a};d.$23=function(){if(!this.state.showConnectionBanner||navigator.userAgent.includes("Firefox"))return null;var a;switch(this.state.connectionState){case b("LiveChatPluginConstants").CONNECTED_STATE:a=null;this.setState({showConnectionBanner:!1});break;case b("LiveChatPluginConstants").CONNECTING_STATE:a=j.jsxs("div",{className:"connecting",children:[j.jsx(b("MessengerSpinner.react"),{className:"connectingSpinner",color:"grey"}),h._("\u9023\u7dda\u4e2d\u2026\u2026")]});break;case b("LiveChatPluginConstants").DISCONNECTED_STATE:a=j.jsx("div",{className:"disconnected",children:h._("\u6c92\u6709\u7db2\u8def\u9023\u7dda")});break;default:a=null;break}return a&&j.jsx("div",{className:"_2oap",children:a},"connection_banner")};d.$33=function(a){if(!b("gkx")("1809711"))return a.last();var c=a.last();for(var d=a.size-1;d>=0;d--){var e=a.get(d);if(e.action_type==="ma-type:user-generated-message"||e.action_type==="ma-type:send-message"){c=e;break}}return c};d.$34=function(a){var b=a.last();for(var c=a.size-1;c>=0;c--){var d=a.get(c);if(d.action_type==="ma-type:user-generated-message"||d.action_type==="ma-type:log-message"){b=d;break}}return b!=null&&b.action_type==="ma-type:log-message"?b:null};d.$18=function(){var a=this.$35(this.state.messages);if(a&&a.quick_replies&&a.quick_replies.length>0){return{data:a.quick_replies,type:(a=a.quick_reply_type)!=null?a:"horizontal"}}return null};d.$19=function(){var a=this;if(this.state.viewerEmail!==null&&this.state.viewerPhone!==null)return;b("promiseDone")(b("WebGraphQL").exec(new(b("MessengerViewerContactMethodsWebGraphQLQuery"))({})),function(b){var c;c=(c=b)!=null?(c=c.viewer)!=null?(c=c.user)!=null?c.all_phones:c:c:c;b=(b=b)!=null?(b=b.viewer)!=null?b.all_emails:b:b;var d=c?c.find(function(a){return a.is_preferred}):null;!d&&c&&c[0]&&(d=c[0]);c=b?b.find(function(a){return a.is_primary}):null;if(a.$2){a.setState({viewerEmail:c?(b=c)!=null?b.display_email:b:"",viewerPhone:d?(c=d)!=null?(c=c.phone_number)!=null?c.universal_number:c:c:""})}})};d.$20=function(){var a=this;if(this.state.viewerState!==null&&this.state.viewerZipCode!==null)return;b("promiseDone")(b("MessengerUserProfileLocationUtils").FetchMessengerUserRegionAndPostalCode(),function(b){var c=b==null?void 0:b.region;b=b==null?void 0:b.postal_code;a.setState({viewerState:c,viewerZipCode:b})})};d.$29=function(a){a=this.$34(a);return a!=null&&a.source==="source:discovery:customer_chat_plugin_escalation"};d.$17=function(a){if(this.$29(a)&&this.context.state.hasActiveAutomation){this.context.dispatchAction({type:"TOGGLE_HAS_ACTIVE_AUTOMATION",hasActiveAutomation:!1});return}a=this.$35(a);if(a===null)return;a.message_classification==="chat_plugin_automation"&&!this.context.state.hasActiveAutomation&&this.context.dispatchAction({type:"TOGGLE_HAS_ACTIVE_AUTOMATION",hasActiveAutomation:!0})};d.$35=function(a){a=this.$33(a);if(this.state.userID==null||!a||!a.platform_xmd||a.author===b("MercuryIDs").getParticipantIDFromUserID(this.state.userID))return null;try{return JSON.parse(a.platform_xmd)}catch(a){return null}};return c}(j.PureComponent);e.exports=a;a.contextType=b("MessagingPluginContext")}),null);